<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"tanqidong1992.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.10.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Modbus协议.">
<meta property="og:type" content="article">
<meta property="og:title" content="Modbus">
<meta property="og:url" content="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/index.html">
<meta property="og:site_name" content="芷兰旧梦">
<meta property="og:description" content="Modbus协议.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/13c1589682ee03c3f75e7d1bad2d648814404ea831a04a5b79844e3083235421.png">
<meta property="og:image" content="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/16f17ef21174125f87a87742bdc0505306493e192057aa0662ad440dc5f87fd8.png">
<meta property="og:image" content="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/50c74b7c1aff238ec130f2da8fe1ddb6ca022847605320ebaf0aff3015c855d2.png">
<meta property="og:image" content="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/9455a09929f72233e465759915ee7948627087c5b82795e7dab873f2ebb7bd7e.png">
<meta property="og:image" content="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/0b8463c4bd849a2e69007ade2c98e3c1cf04cb30e193321e5fbc8c6908212be0.png">
<meta property="og:image" content="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/92551356980e4ac382c52bb769f792f81cd0e260df5d253c68164ae7d2764ba9.png">
<meta property="og:image" content="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/8f0ab1d31267153dff431af3b82d1274448c3343bc6e50118a028780600e80d0.png">
<meta property="og:image" content="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/efc2e1c2b08517a33cf1269b58fa432e46d19f4e848dc734779f438f4936fe2d.png">
<meta property="og:image" content="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/7d0c7f513bb19748d4874f4a7a22fabf1ef654a1bde7957a7e650c1911f655df.png">
<meta property="og:image" content="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/public-function-codes.png">
<meta property="article:published_time" content="2021-09-02T13:51:33.000Z">
<meta property="article:modified_time" content="2023-02-13T13:30:14.260Z">
<meta property="article:author" content="芷兰旧梦">
<meta property="article:tag" content="Modbus">
<meta property="article:tag" content="IOT">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/13c1589682ee03c3f75e7d1bad2d648814404ea831a04a5b79844e3083235421.png">


<link rel="canonical" href="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/","path":"2021/09/02/2021/09/02/modbus/","title":"Modbus"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Modbus | 芷兰旧梦</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="芷兰旧梦" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">芷兰旧梦</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">偶尔记一些东西</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Modbus"><span class="nav-number">1.</span> <span class="nav-text">Modbus</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Modbus%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%E6%A0%88"><span class="nav-number">1.2.</span> <span class="nav-text">Modbus通信协议栈</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Modbus%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84"><span class="nav-number">1.3.</span> <span class="nav-text">Modbus网络架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%8F%E8%AE%AE%E6%8F%8F%E8%BF%B0"><span class="nav-number">1.4.</span> <span class="nav-text">协议描述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%8F%E8%AE%AE%E7%BB%84%E6%88%90"><span class="nav-number">1.4.1.</span> <span class="nav-text">协议组成</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#PDU"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">PDU</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Modbus-Request-PDU"><span class="nav-number">1.4.1.1.1.</span> <span class="nav-text">Modbus Request PDU</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Modbus-Response-PDU"><span class="nav-number">1.4.1.1.2.</span> <span class="nav-text">Modbus Response PDU</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Modbus-Exception-Response-PDU"><span class="nav-number">1.4.1.1.3.</span> <span class="nav-text">Modbus Exception Response PDU</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ADU"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">ADU</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ADU-Modbus-Frame-with-Serial-Transmission"><span class="nav-number">1.4.1.2.1.</span> <span class="nav-text">ADU(Modbus Frame with Serial Transmission)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ADU-Modbus-Frame-With-TCP-x2F-IP-Transmission"><span class="nav-number">1.4.1.2.2.</span> <span class="nav-text">ADU(Modbus Frame With TCP&#x2F;IP Transmission)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%BC%96%E7%A0%81%E5%AD%97%E8%8A%82%E5%BA%8F"><span class="nav-number">1.4.2.</span> <span class="nav-text">数据编码字节序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Modbus%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.4.3.</span> <span class="nav-text">Modbus数据模型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">实现示例</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Modbus%E5%AF%BB%E5%9D%80%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.4.4.</span> <span class="nav-text">Modbus寻址模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Modbus%E4%BA%8B%E5%8A%A1%E5%AE%9A%E4%B9%89"><span class="nav-number">1.4.5.</span> <span class="nav-text">Modbus事务定义</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD%E7%A0%81%E7%B1%BB%E5%88%AB"><span class="nav-number">1.5.</span> <span class="nav-text">功能码类别</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AC%E5%85%B1%E5%8A%9F%E8%83%BD%E7%A0%81"><span class="nav-number">1.5.1.</span> <span class="nav-text">公共功能码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8A%9F%E8%83%BD%E7%A0%81"><span class="nav-number">1.5.2.</span> <span class="nav-text">用户自定义功能码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%9D%E7%95%99%E5%8A%9F%E8%83%BD%E7%A0%81"><span class="nav-number">1.5.3.</span> <span class="nav-text">保留功能码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AC%E5%85%B1%E5%8A%9F%E8%83%BD%E7%A0%81%E5%AE%9A%E4%B9%89"><span class="nav-number">1.6.</span> <span class="nav-text">公共功能码定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">1.7.</span> <span class="nav-text">参考</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">芷兰旧梦</p>
  <div class="site-description" itemprop="description">只是为了好玩</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">55</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">92</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/tanqidong1992" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tanqidong1992" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://forrestsu.github.io/" title="https:&#x2F;&#x2F;forrestsu.github.io&#x2F;" rel="noopener" target="_blank">程序员的冷浪漫</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="芷兰旧梦">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="芷兰旧梦">
      <meta itemprop="description" content="只是为了好玩">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Modbus | 芷兰旧梦">
      <meta itemprop="description" content="Modbus协议.">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Modbus
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-02 21:51:33" itemprop="dateCreated datePublished" datetime="2021-09-02T21:51:33+08:00">2021-09-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-02-13 21:30:14" itemprop="dateModified" datetime="2023-02-13T21:30:14+08:00">2023-02-13</time>
    </span>

  
</div>

            <div class="post-description">Modbus协议.</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Modbus"><a href="#Modbus" class="headerlink" title="Modbus"></a>Modbus</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Modbus是一个位于应用层的消息传递协议,位于OSI模型第七层.它为连接在不同总线或者网络上的设备之间提供客户端&#x2F;服务器通信.</p>
<p>自1979年以来,Modbus一直是业界公认的串行标准,至今仍在为数以百万计的自动化设备提供通信服务.</p>
<p>Modbus是一种请求应答协议,提供功能代码(Function Code)指定的服务.</p>
<p>目前它主要基于以下几种媒介实现:</p>
<ul>
<li>TCP&#x2F;IP over Ethernet.</li>
<li>Asynchronized serial transmission over a variety of media(EIA&#x2F;TIA-232-E(RS-232),EIA-422,EIA&#x2F;TIA-485-A(RS-485),光纤,无线广播等).</li>
<li>Modbus PLUS,高速令牌传递网络.<br>  备注: Modbus在TCP&#x2F;IP协议栈上的保留端口为502.</li>
</ul>
<h2 id="Modbus通信协议栈"><a href="#Modbus通信协议栈" class="headerlink" title="Modbus通信协议栈"></a>Modbus通信协议栈</h2><p><img src="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/13c1589682ee03c3f75e7d1bad2d648814404ea831a04a5b79844e3083235421.png"></p>
<h2 id="Modbus网络架构"><a href="#Modbus网络架构" class="headerlink" title="Modbus网络架构"></a>Modbus网络架构</h2><p><img src="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/16f17ef21174125f87a87742bdc0505306493e192057aa0662ad440dc5f87fd8.png"></p>
<h2 id="协议描述"><a href="#协议描述" class="headerlink" title="协议描述"></a>协议描述</h2><h3 id="协议组成"><a href="#协议组成" class="headerlink" title="协议组成"></a>协议组成</h3><p>Modbus定义了一个简单,独立于通信层的协议数据单元(PDU).Modbus协议在特定总线或者网络上的实现,可以在应用数据单元(ADU)中引入额外的字段.一般的Modbus数据帧如下图所示:</p>
<p><img src="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/50c74b7c1aff238ec130f2da8fe1ddb6ca022847605320ebaf0aff3015c855d2.png"></p>
<h4 id="PDU"><a href="#PDU" class="headerlink" title="PDU"></a>PDU</h4><p>PDU由功能码(Function Code)，数据组成：</p>
<ul>
<li>功能码指明了服务器应该执行何种操作.它被编码为1个字节,取值范围为[1,255]的整数(其中128-255被保留,作为异常码使用),<strong>在一些功能码中添加子功能码(子功能代码位于数据字段内),可以为一个功能码定义多个操作.</strong></li>
<li>数据是客户端传递给服务端为执行执行功能码指定操作的附带信息,可以是离散地址,寄存器地址,要处理项的数量等.在某些类型的请求中,数据字段可能不存在.</li>
</ul>
<p>PDU的最大值为256字节,这个最大值受限于第一个modbus在串口网络的实现(max RS485 ADU &#x3D; 256 bytes)</p>
<p>因此:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Modbus PDU for serial line communication = 256 - Server address (1 byte) - CRC(2 bytes) = 253 bytes</span><br></pre></td></tr></table></figure>

<p>故而</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RS232/RS485 ADU = 253 + Server Address (1 byte) + CRC (2 bytes) = 256 bytes</span><br><span class="line">TCP Modbus ADU = 253 bytes + MBAP( 7 bytes ) = 260 bytes</span><br></pre></td></tr></table></figure>

<p>Modbus 一共定义了三种PDU</p>
<ul>
<li>Modbus Request PDU, mb_req_pdu.</li>
<li>Modbus Response PDU, mb_rsp_pdu.</li>
<li>Modbus Exception Response PDU, md_excep_rsp_pdu.</li>
</ul>
<h5 id="Modbus-Request-PDU"><a href="#Modbus-Request-PDU" class="headerlink" title="Modbus Request PDU"></a>Modbus Request PDU</h5><p>由功能码 + 请求数据组成:<br>功能码: 1个字节,<br>请求数据: n个字节,可取值:变量引用,变量数量,数据偏移,子功能代码等.</p>
<h5 id="Modbus-Response-PDU"><a href="#Modbus-Response-PDU" class="headerlink" title="Modbus Response PDU"></a>Modbus Response PDU</h5><p>由功能码 + 响应数据组成:<br>功能码: 1个字节,<br>响应数据: n个字节,可取值:变量引用,变量数量,数据偏移,子功能代码等.</p>
<h5 id="Modbus-Exception-Response-PDU"><a href="#Modbus-Exception-Response-PDU" class="headerlink" title="Modbus Exception Response PDU"></a>Modbus Exception Response PDU</h5><p>由异常功能码 + 请求数据组成:<br>异常代码: 1个字节,是功能代码+0x80.</p>
<h4 id="ADU"><a href="#ADU" class="headerlink" title="ADU"></a>ADU</h4><h5 id="ADU-Modbus-Frame-with-Serial-Transmission"><a href="#ADU-Modbus-Frame-with-Serial-Transmission" class="headerlink" title="ADU(Modbus Frame with Serial Transmission)"></a>ADU(Modbus Frame with Serial Transmission)</h5><p>基于串口通信的ADU由设备地址(1 bytes),PDU(253 bytes),错误校验组成(2 bytes).</p>
<h5 id="ADU-Modbus-Frame-With-TCP-x2F-IP-Transmission"><a href="#ADU-Modbus-Frame-With-TCP-x2F-IP-Transmission" class="headerlink" title="ADU(Modbus Frame With TCP&#x2F;IP Transmission)"></a>ADU(Modbus Frame With TCP&#x2F;IP Transmission)</h5><p>基于TCP&#x2F;IP实现的ADU由MBAP(7 bytes),PDU(253 bytes)组成.<br>MBAP由事务标识符,协议标识符,长度,单位标识符组成,如下图所示:</p>
<p><img src="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/9455a09929f72233e465759915ee7948627087c5b82795e7dab873f2ebb7bd7e.png">- 事务标识符,用于事务匹配,服务器在响应中复制客户端请求中的值.如果客户端在每次查询时生成唯一的表示符,则可以为此查询分配唯一的响应.</p>
<ul>
<li>协议标识符,由于使用Modbus协议,因此此字段始终为0.</li>
<li>长度,数据长度,包括单位标识符(1 byte),函数代码(1 byte)和数据.</li>
<li>单位标识符,对应基于串口通信的Modbus协议ADU中的设备地址.此字段用于内部系统路由,如果控制器不支持路由,此字段始终为0.</li>
</ul>
<p>备注:由于TCP&#x2F;IP数据链路层的校验机制保证了数据的完整性,因此Modbus TCP的报文中不再带有数据校验.</p>
<h3 id="数据编码字节序"><a href="#数据编码字节序" class="headerlink" title="数据编码字节序"></a>数据编码字节序</h3><p>Modbus协议在发送数据时,采用与网络一样大端字节序发送数据,首先发送MSB.</p>
<h3 id="Modbus数据模型"><a href="#Modbus数据模型" class="headerlink" title="Modbus数据模型"></a>Modbus数据模型</h3><table>
<thead>
<tr>
<th align="left">基本表</th>
<th align="left">对象类型</th>
<th align="left">访问类型</th>
<th align="left">注释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">离散量输入</td>
<td align="left">单个位</td>
<td align="left">只读</td>
<td align="left">I&#x2F;O系统可提供这种类型的数据</td>
</tr>
<tr>
<td align="left">线圈</td>
<td align="left">单个位</td>
<td align="left">读写</td>
<td align="left">通过应用程序可以改变这种类型的数据</td>
</tr>
<tr>
<td align="left">输入寄存器</td>
<td align="left">16位 字</td>
<td align="left">只读</td>
<td align="left">I&#x2F;O系统可提供这种类型的数据</td>
</tr>
<tr>
<td align="left">保持寄存器</td>
<td align="left">16位 字</td>
<td align="left">读写</td>
<td align="left">通过应用程序可以改变这种类型数据</td>
</tr>
</tbody></table>
<p>对于每一个基本表,协议都允许单个地选择65535个数据项.</p>
<h4 id="实现示例"><a href="#实现示例" class="headerlink" title="实现示例"></a>实现示例</h4><p>设备组织数据的方法有很多种,每个设备根据其应用都有自己的组织数据的方法.</p>
<ol>
<li>示例1,含有四个独立块的设备</li>
</ol>
<p><img src="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/0b8463c4bd849a2e69007ade2c98e3c1cf04cb30e193321e5fbc8c6908212be0.png">2. 示例2,含有单个独立块的设备</p>
<p><img src="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/92551356980e4ac382c52bb769f792f81cd0e260df5d253c68164ae7d2764ba9.png"></p>
<h3 id="Modbus寻址模型"><a href="#Modbus寻址模型" class="headerlink" title="Modbus寻址模型"></a>Modbus寻址模型</h3><p>Modbus应用协议精确地定义了PDU寻址规则.<br>在Modbu PDU中,从0<del>65535寻址每一个数据.<br>Modbus应用协议明确地规定了由四个块构成的Modbus数据模型,每个块由几个编号为1</del>n的元素构成.<br>在Modbus数据模型中,从1~n来编号每一个元素.<br>Modbus数据模型和设备应用之间的映射完全与特定设备无关.</p>
<p><img src="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/8f0ab1d31267153dff431af3b82d1274448c3343bc6e50118a028780600e80d0.png"></p>
<h3 id="Modbus事务定义"><a href="#Modbus事务定义" class="headerlink" title="Modbus事务定义"></a>Modbus事务定义</h3><p>如图所示描述了在服务侧Modbus事务处理的一般处理流程</p>
<p><img src="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/efc2e1c2b08517a33cf1269b58fa432e46d19f4e848dc734779f438f4936fe2d.png"></p>
<p>一旦服务器处理请求,就必须使用相应的Modbus服务器事务处理生成Modbus响应.<br>根据处理结果,可以建立两种类型响应:</p>
<ol>
<li>一个正常的Modbus响应:响应功能码&#x3D;请求功能码</li>
<li>一个异常的Modbus响应:异常功能码&#x3D;请求功能码 + 0x80<br>用来为客户机提供处理过程中与所发现的差错相关的信息,提供异常码来表示发生差错的原因.</li>
</ol>
<h2 id="功能码类别"><a href="#功能码类别" class="headerlink" title="功能码类别"></a>功能码类别</h2><p>共有三类Modbus功能码,分为为:公共功能码,用户自定义功能码,保留功能码.它们的分布如下:</p>
<p><img src="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/7d0c7f513bb19748d4874f4a7a22fabf1ef654a1bde7957a7e650c1911f655df.png"></p>
<h3 id="公共功能码"><a href="#公共功能码" class="headerlink" title="公共功能码"></a>公共功能码</h3><ol>
<li>被确切定义的功能码.</li>
<li>保证是唯一的.</li>
<li>由MODBUS.org组织验证.</li>
<li>公开文档.</li>
<li>可进行一致性测试.</li>
<li>包含已被定义的公共功能码和保留给未来使用的功能码.</li>
</ol>
<h3 id="用户自定义功能码"><a href="#用户自定义功能码" class="headerlink" title="用户自定义功能码"></a>用户自定义功能码</h3><ol>
<li>共有两个用户自定义功能码区域,即十进制的65-72,100-110.</li>
<li>用户无需Modbus组织的任何批准就可以选择和实现一个功能码.</li>
<li>不能保证被选用的功能码的使用是唯一的.</li>
<li>如果用户希望将某种功能设置为一个公共功能码,那么用户必须启动RFC,以便将这种变更引入公共分类中,并且指配一个新的公共功能码.</li>
</ol>
<h3 id="保留功能码"><a href="#保留功能码" class="headerlink" title="保留功能码"></a>保留功能码</h3><p>某些公司在传统产品上先行使用的功能码,不作为公共使用.</p>
<h2 id="公共功能码定义"><a href="#公共功能码定义" class="headerlink" title="公共功能码定义"></a>公共功能码定义</h2><p><img src="http://tanqidong1992.github.io/2021/09/02/2021/09/02/modbus/public-function-codes.png"></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="https://modbus.org/docs/Modbus_Application_Protocol_V1_1b3.pdf">Modbus_Application_Protocol_V1_1b3</a></li>
<li><a target="_blank" rel="noopener" href="http://www.ad.siemens.com.cn/productportal/Prods/published/Comm/Comm_9.1/Comm_9.1.html">Modbus TCP通信概述</a></li>
<li><a target="_blank" rel="noopener" href="https://en.nanotec.com/products/manual/PD4E_ModbusTCP_ZH/bus%2Fmodbus%2Fmbap_header.html">技术手册 PD4-E MODBUS TCP</a></li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Modbus/" rel="tag"># Modbus</a>
              <a href="/tags/IOT/" rel="tag"># IOT</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/07/02/2021/07/02/introduction-of-ffmpeg/" rel="prev" title="FFmpeg入门学习">
                  <i class="fa fa-chevron-left"></i> FFmpeg入门学习
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/12/28/2021/12/28/rpm/" rel="next" title="Fedora下RPM包制作">
                  Fedora下RPM包制作 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">芷兰旧梦</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
