<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="https://www.w3.org/2005/Atom">
  <title>tqd</title>
  
  <subtitle>偶尔记一些东西</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://tanqidong1992.github.io/"/>
  <updated>2019-11-10T01:28:48.110Z</updated>
  <id>http://tanqidong1992.github.io/</id>
  
  <author>
    <name>tqd</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>shell函数</title>
    <link href="http://tanqidong1992.github.io/2019/11/08/shell%E5%87%BD%E6%95%B0/"/>
    <id>http://tanqidong1992.github.io/2019/11/08/shell%E5%87%BD%E6%95%B0/</id>
    <published>2019-11-08T14:54:38.000Z</published>
    <updated>2019-11-10T01:28:48.110Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Shell函数的定义"><a href="#Shell函数的定义" class="headerlink" title="Shell函数的定义"></a>Shell函数的定义</h2><p>函数组成</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function [函数名]()</span><br><span class="line">&#123;</span><br><span class="line">    #函数体</span><br><span class="line">    commands...</span><br><span class="line">    #返回语句,返回值的取值范围0-255</span><br><span class="line">    return int</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>关键字<strong>function</strong>可以省略.</li><li>使用关键字<strong>function</strong>时,可以将括号省略.</li><li><strong>return</strong>语句可以省略,如果没有返回语句,那么最后一行命令执行的返回值作为函数的返回值.</li><li>返回值的取值范围为<strong>0-255</strong></li></ul><p>函数定义示例</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">计算两数之和</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数1 数字</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数2 数字</span></span><br><span class="line">function sum()&#123;</span><br><span class="line">    arg1=$1</span><br><span class="line">    arg2=$2</span><br><span class="line">    let c=arg1+arg2</span><br><span class="line">    echo $c</span><br><span class="line">    return 0</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">省略了<span class="keyword">function</span>关键字</span></span><br><span class="line">add()&#123;</span><br><span class="line"><span class="meta">   #</span><span class="bash">此函数的返回值为sum函数的返回值</span></span><br><span class="line">   sum 1 2</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">省略了()</span></span><br><span class="line">function add1</span><br><span class="line">&#123;</span><br><span class="line">    sum 1 2</span><br><span class="line">    return 1</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">单行函数,每行命令都需要以<span class="string">';'</span>分割</span></span><br><span class="line">add2() &#123; c=$(sum 1 2) ; echo "sum is:$&#123;c&#125;"; &#125;</span><br><span class="line"></span><br><span class="line">function add3 &#123; c=$(sum 1 2) ; echo "sum is:$&#123;c&#125;"; &#125;</span><br><span class="line"></span><br><span class="line">a=1</span><br><span class="line">b=2</span><br><span class="line">let c=$(sum $&#123;a&#125; $&#123;b&#125;)</span><br><span class="line">echo "sum of a and b is:$c"</span><br><span class="line">echo "exit value is:$?"</span><br><span class="line">echo "invoke add:$(add)"</span><br><span class="line">echo "invoke add exit value:$?"</span><br><span class="line">add1</span><br><span class="line">echo "invoke add1 exit value:$?"</span><br><span class="line">echo "invoke add2:$(add2)"</span><br><span class="line">echo "invoke add2 exit value:$?"</span><br><span class="line">add3</span><br></pre></td></tr></table></figure><h2 id="函数的参数-变量-返回值"><a href="#函数的参数-变量-返回值" class="headerlink" title="函数的参数,变量,返回值"></a>函数的参数,变量,返回值</h2><h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><p>Shell函数有自己的命令行参数.函数使用特殊变量$1，$2，…$n来访问传递给它的参数。函数中使用参数的示例如下.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">name()&#123;</span><br><span class="line">    #参数个数</span><br><span class="line">    argSize=$#</span><br><span class="line">    echo "arg size:$&#123;argSize&#125;"</span><br><span class="line">    #所有参数</span><br><span class="line">    allArgs=$@</span><br><span class="line">    echo "all args[\$@]:$&#123;allArgs&#125;"</span><br><span class="line">    allArgs=$*</span><br><span class="line">    echo "all args[\$*]:$&#123;allArgs&#125;"</span><br><span class="line">    #读取第一个参数,如果是第n个则用$&#123;n&#125;</span><br><span class="line">    arg1=$1</span><br><span class="line">    echo "first arg:$arg1"</span><br><span class="line">    #第0个参数,是当前脚本名</span><br><span class="line">    arg0=$0</span><br><span class="line">    echo "arg0:$arg0"</span><br><span class="line">    #循环遍历所有参数</span><br><span class="line">    echo "循环遍历所有参数"</span><br><span class="line">    for ((i=1;i&lt;=argSize;i++))</span><br><span class="line">    do</span><br><span class="line">       t=$&#123;!i&#125;</span><br><span class="line">       echo "arg$&#123;i&#125;:$&#123;t&#125;"</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br><span class="line">name p1 p2 p3</span><br></pre></td></tr></table></figure><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>默认情况下shell中定义的变量都是全局的.在函数中使用的变量,为了不影响全局变量,可以使用local命令来声明一个局部变量,局部变量将会屏蔽掉同名的全局变量.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">global_a=-1</span><br><span class="line">global_b=-1</span><br><span class="line"><span class="function"><span class="title">sum</span></span>()&#123;</span><br><span class="line">    a=<span class="variable">$1</span></span><br><span class="line">    b=<span class="variable">$2</span></span><br><span class="line">    <span class="comment">#定义全局变量c</span></span><br><span class="line">    <span class="built_in">let</span> c=a+b</span><br><span class="line">    <span class="comment">#定义局部变量d,函数外无法访问</span></span><br><span class="line">    <span class="built_in">local</span> d</span><br><span class="line">    <span class="built_in">let</span> d=a+b</span><br><span class="line">    <span class="comment">#使用全局变量global_b</span></span><br><span class="line">    global_b=<span class="variable">$d</span></span><br><span class="line">    <span class="comment">#定义局部变量global_a,屏蔽了已定义的全局变量global_a</span></span><br><span class="line">    <span class="built_in">local</span> global_a</span><br><span class="line">    global_a=<span class="variable">$d</span></span><br><span class="line">&#125;</span><br><span class="line">sum 1 2</span><br><span class="line"><span class="comment"># 此处c为3</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"c:<span class="variable">$c</span>"</span></span><br><span class="line"><span class="comment"># 此处 d为空</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"d:<span class="variable">$d</span>"</span></span><br><span class="line"><span class="comment"># 此处global_a为-1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"global_a:<span class="variable">$global_a</span>"</span></span><br><span class="line"><span class="comment">#此处global_b为3</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"global_b:<span class="variable">$global_b</span>"</span></span><br></pre></td></tr></table></figure><h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><p>函数通过return指令返回返回值</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">判断进程是否存在</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数1 进程号</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回值 1表示进程不存在,0表示进程存在</span></span><br><span class="line">function isProcessExist()&#123;</span><br><span class="line">    local pid=$1</span><br><span class="line">    if [ -z $pid ]; then</span><br><span class="line">        return 1</span><br><span class="line">    fi</span><br><span class="line">    if [ -e "/proc/$&#123;pid&#125;" ]; then</span><br><span class="line">        return 0</span><br><span class="line">    else</span><br><span class="line">        return 1</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pid='1'</span><br><span class="line">isProcessExist $pid</span><br><span class="line"></span><br><span class="line">if [ $? -eq 0 ]; then</span><br><span class="line">    echo "Process[$&#123;pid&#125;] is exists!"</span><br><span class="line">else</span><br><span class="line">    echo "Process[$&#123;pid&#125;] is not exists!"</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h2 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a>函数调用</h2><p>函数调用语法</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">函数名 参数1 参数2 .. 参数n</span><br></pre></td></tr></table></figure><p>备注:通过’.’,source指令可以引入外部脚本文件,调用外部的脚本文件中的函数</p><h2 id="后台运行函数"><a href="#后台运行函数" class="headerlink" title="后台运行函数"></a>后台运行函数</h2><p>在调用的末尾加上&amp;,即可将函数置于后台运行,语法如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">函数名 参数1 参数2 .. 参数n &amp;</span><br></pre></td></tr></table></figure><p>示例</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">判断进程是否存在</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数1 进程号</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回值 1表示存在,0表示不存在</span></span><br><span class="line">function isProcessExist()&#123;</span><br><span class="line">    pid=$1</span><br><span class="line">    if [ -f "proc/$&#123;pid&#125;"]; then</span><br><span class="line">        return 1</span><br><span class="line">    else</span><br><span class="line">        return 0</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function longTask()&#123;</span><br><span class="line">    times=$1</span><br><span class="line">    for ((i=0;i&lt;$&#123;times&#125;;i++))</span><br><span class="line">    do</span><br><span class="line">        #echo "do sub task $&#123;i&#125;..."</span><br><span class="line">        sleep 1</span><br><span class="line">    done</span><br><span class="line">    return 2</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">在后台执行长时间运行的函数</span></span><br><span class="line">longTask 12 &amp;</span><br><span class="line">pid=$!</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">echo</span> <span class="string">"pid:<span class="variable">$&#123;pid&#125;</span>"</span></span></span><br><span class="line">wait_loop_times=0</span><br><span class="line">until [ ! -e "/proc/$&#123;pid&#125;" ]</span><br><span class="line">do</span><br><span class="line">    dots=""</span><br><span class="line">    for ((i=0;i&lt;wait_loop_times;i++))</span><br><span class="line">    do</span><br><span class="line">        dots+="."</span><br><span class="line">    done</span><br><span class="line">    printf "%-100s\r" "等待$&#123;dots&#125;"</span><br><span class="line">    let wait_loop_times++</span><br><span class="line">    sleep 1</span><br><span class="line">done</span><br><span class="line">printf "\n"</span><br><span class="line">wait $pid</span><br><span class="line">echo "进程:$&#123;pid&#125;已经结束,退出值:$?"</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      介绍Shell函数的定义,一些示例脚本.
    
    </summary>
    
    
    
      <category term="Bash" scheme="http://tanqidong1992.github.io/tags/Bash/"/>
    
      <category term="Shell" scheme="http://tanqidong1992.github.io/tags/Shell/"/>
    
      <category term="Linux" scheme="http://tanqidong1992.github.io/tags/Linux/"/>
    
      <category term="函数" scheme="http://tanqidong1992.github.io/tags/%E5%87%BD%E6%95%B0/"/>
    
      <category term="阅读笔记" scheme="http://tanqidong1992.github.io/tags/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>10月6日途遇一骗子</title>
    <link href="http://tanqidong1992.github.io/2019/10/06/10%E6%9C%886%E6%97%A5/"/>
    <id>http://tanqidong1992.github.io/2019/10/06/10%E6%9C%886%E6%97%A5/</id>
    <published>2019-10-06T07:45:54.000Z</published>
    <updated>2019-10-07T12:15:00.363Z</updated>
    
    <content type="html"><![CDATA[<p>10月6日从家里回长沙后,在租房小区附近,遇到一个骗子.上当的原因:</p><ul><li>不善于拒绝人.</li><li>心存善念.</li><li>活在书里.</li><li>遇事不够冷静.</li><li>对小钱不在乎了.</li></ul><p>后来又想起在车上看过的一段话:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">我选择，即我相信。往大里说，我相信美好和善良，相信礼义廉耻曾经存在过，跟不相信美好和善良，不相信礼义廉耻曾经存在过，对自己来说，效果完全是两回事；有希贤希圣之心，和没有希贤希圣之心，对当下人来说，是两回事。后者无疑是内心寂灭似的冷酷、无趣而凉薄的聪明。明代人陈眉公说：“见善则疑，闻恶则喜，此满腔杀机也。”</span><br><span class="line"></span><br><span class="line">越来越多的现象显示，被所谓新文化所化的现代人，多数是这种满腔杀机的聪明人。在他们看来，所谓从前，所谓传统和历史，真可谓“万恶的旧社会”，曾经的善良和美好皆不可信。更甚者，今天的许多人，自己做不到的美好，就认为不可信，自己没见过的醇善，亦不可信。今天的人，为什么那么容易相信恶？甚至认为只有相信了恶，给种种恶寻找历史的逻辑和依据，并因此认为恶才是真实的人性。这种相信恶的集体意识，导致了当下一种可怕的价值：他人是禽兽的话，我一定要做到禽兽不如，否则我就吃亏了。</span><br><span class="line">                                                       节选自&lt;&lt;桃花扇底看前朝&gt;&gt;自序 许石林</span><br></pre></td></tr></table></figure><p>有时有些事情,就是这么的巧合.</p>]]></content>
    
    <summary type="html">
    
      对陌生人再无恻隐之心.
    
    </summary>
    
    
    
      <category term="教训,反省" scheme="http://tanqidong1992.github.io/tags/%E6%95%99%E8%AE%AD-%E5%8F%8D%E7%9C%81/"/>
    
  </entry>
  
  <entry>
    <title>再读&lt;&lt;黔之驴&gt;&gt;</title>
    <link href="http://tanqidong1992.github.io/2019/09/21/%E5%86%8D%E8%AF%BB%E9%BB%94%E4%B9%8B%E9%A9%B4/"/>
    <id>http://tanqidong1992.github.io/2019/09/21/%E5%86%8D%E8%AF%BB%E9%BB%94%E4%B9%8B%E9%A9%B4/</id>
    <published>2019-09-21T12:08:10.000Z</published>
    <updated>2019-10-07T12:51:35.165Z</updated>
    
    <content type="html"><![CDATA[<p>​        我是一个胆小的人,一直害怕自己成为一个没用的人,所以对于黔驴技穷这个成语记的很深,它的出处自然记的清白.一直以来,我只关注文中驴的形象,却没有注意到文中的老虎.</p><p>​        最近一段时间,与很多生人一起共事了一段时间,觉得这些人(包括我自己)就好比文中的老虎与驴.每个人到底是老虎还是驴自己都应该清楚吧,有些人(说话的时候)看起来像是老虎,(写代码的时候)又像是驴.这段时间,我很多时候都是笑而不语.我在发呆的时候,想起了&lt;&lt;黔之驴&gt;&gt;这篇文章,文中的老虎,可谓十分强大,但是在面对一个陌生事物的时候,是多么小心与谨慎,而文中的驴,我感觉他有点无奈…</p><p>​        总之,静水流深,大智若愚.</p><p>​        这段时间因为工作比较忙,而自己还要打理好自己的游戏,所以过的很乱.最近跟很多人打交道的时候,说话都很小声,以前是以为自己很久没人说话了,不会说话了,现在觉得是自己书读得少,不敢大声说话.还是打算买一两本书看看,不然真觉得自己要废了.</p><p>最后附上原文:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                                黔之驴 -- 柳宗元</span><br><span class="line">                                </span><br><span class="line">黔无驴，有好事者船载以入。至则无可用，放之山下。虎见之，庞然大物也，以为神，蔽林间窥之。稍出近之，慭慭然，莫相知。</span><br><span class="line"></span><br><span class="line">他日，驴一鸣，虎大骇，远遁；以为且噬己也，甚恐。然往来视之，觉无异能者；益习其声，又近出前后，终不敢搏。稍近，益狎，荡倚冲冒。驴不胜怒，蹄之。虎因喜，计之曰：“技止此耳！”因跳踉大㘎，断其喉，尽其肉，乃去。</span><br><span class="line"></span><br><span class="line">噫！形之庞也类有德，声之宏也类有能。向不出其技，虎虽猛，疑畏，卒不敢取。今若是焉，悲夫！</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      对于&lt;&lt;黔之驴&gt;&gt;这篇课文,以前自己只知道驴,忘了老虎的形象.
    
    </summary>
    
    
    
      <category term="生活感悟,反思" scheme="http://tanqidong1992.github.io/tags/%E7%94%9F%E6%B4%BB%E6%84%9F%E6%82%9F-%E5%8F%8D%E6%80%9D/"/>
    
  </entry>
  
  <entry>
    <title>武学在于心</title>
    <link href="http://tanqidong1992.github.io/2019/08/13/%E6%AD%A6%E5%AD%A6%E5%9C%A8%E4%BA%8E%E5%BF%83/"/>
    <id>http://tanqidong1992.github.io/2019/08/13/%E6%AD%A6%E5%AD%A6%E5%9C%A8%E4%BA%8E%E5%BF%83/</id>
    <published>2019-08-13T11:24:28.000Z</published>
    <updated>2019-08-13T11:28:40.882Z</updated>
    
    <content type="html"><![CDATA[<p>武学在于心，既不在于兵刃，又不在于四肢.</p><p>​                                                                           –侠客行第十八集，00:43:16</p>]]></content>
    
    <summary type="html">
    
      武学在于心，既不在于兵刃，又不在于四肢
    
    </summary>
    
    
    
      <category term="阅读" scheme="http://tanqidong1992.github.io/tags/%E9%98%85%E8%AF%BB/"/>
    
      <category term="侠客行" scheme="http://tanqidong1992.github.io/tags/%E4%BE%A0%E5%AE%A2%E8%A1%8C/"/>
    
      <category term="电视剧" scheme="http://tanqidong1992.github.io/tags/%E7%94%B5%E8%A7%86%E5%89%A7/"/>
    
  </entry>
  
  <entry>
    <title>基于Docker,FastDFS和Nginx的分布式文件系统的搭建</title>
    <link href="http://tanqidong1992.github.io/2019/07/20/%E5%9F%BA%E4%BA%8EFastDFS%E5%92%8CNginx%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%90%AD%E5%BB%BA/"/>
    <id>http://tanqidong1992.github.io/2019/07/20/%E5%9F%BA%E4%BA%8EFastDFS%E5%92%8CNginx%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%90%AD%E5%BB%BA/</id>
    <published>2019-07-20T02:10:00.000Z</published>
    <updated>2019-07-22T16:01:33.904Z</updated>
    
    <content type="html"><![CDATA[<h2 id="基于Docker-FastDFS和Nginx的分布式文件系统的搭建"><a href="#基于Docker-FastDFS和Nginx的分布式文件系统的搭建" class="headerlink" title="基于Docker,FastDFS和Nginx的分布式文件系统的搭建"></a>基于Docker,FastDFS和Nginx的分布式文件系统的搭建</h2><h3 id="原理介绍"><a href="#原理介绍" class="headerlink" title="原理介绍"></a>原理介绍</h3><p><a href="https://www.cnblogs.com/mujingyu/p/8569790.html" target="_blank" rel="noopener">参考</a></p><h3 id="下载源码"><a href="#下载源码" class="headerlink" title="下载源码"></a>下载源码</h3>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;BASE_PATH&#125;</span><br><span class="line">git clone git@github.com:happyfish100/fastdfs.git</span><br></pre></td></tr></table></figure><h3 id="在Docker中编译"><a href="#在Docker中编译" class="headerlink" title="在Docker中编译"></a>在Docker中编译</h3><p>下载 fastdfs,libfastcommon,nginx,fastdfs-nginx-module的源代码压缩包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd $&#123;BASE_PATH&#125;/fastdfs/docker/dockerfile_local</span><br><span class="line"></span><br><span class="line">wget https://github.com/happyfish100/fastdfs/archive/V5.11.tar.gz -O fastdfs.tar.gz</span><br><span class="line"></span><br><span class="line">wget https://github.com/happyfish100/libfastcommon/archive/V1.0.39.tar.gz -O libfastcommon.tar.gz</span><br><span class="line"></span><br><span class="line">wget https://github.com/happyfish100/fastdfs-nginx-module/archive/V1.20.tar.gz -O fastdfs-nginx-module.tar.gz</span><br><span class="line"></span><br><span class="line">wget https://github.com/nginx/nginx/archive/release-1.17.1.tar.gz -O nginx.tar.gz</span><br></pre></td></tr></table></figure><h4 id="代码修改"><a href="#代码修改" class="headerlink" title="代码修改"></a>代码修改</h4><p>对压缩包fastdfs-nginx-module.tar.gz中的fastdfs-nginx-module-1.20\src\config文件做如下修改</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ngx_module_incs="/usr/local/include" </span><br><span class="line">    改为</span><br><span class="line">ngx_module_incs="/usr/include/fastdfs /usr/include/fastcommon/"</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CORE_INCS="$CORE_INCS /usr/local/include" </span><br><span class="line">改为</span><br><span class="line">CORE_INCS="$CORE_INCS /usr/include/fastdfs /usr/include/fastcommon/"</span><br></pre></td></tr></table></figure><h4 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos 7</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="number">192.168</span>.<span class="number">0.140</span>:<span class="number">8084</span>/hnvmns/centos</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加源文件</span></span><br><span class="line"><span class="comment"># add source code</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="built_in">source</span>/libfastcommon.tar.gz /usr/<span class="built_in">local</span>/src/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="built_in">source</span>/fastdfs.tar.gz /usr/<span class="built_in">local</span>/src/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="built_in">source</span>/fastdfs-nginx-module.tar.gz /usr/<span class="built_in">local</span>/src/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="built_in">source</span>/nginx.tar.gz /usr/<span class="built_in">local</span>/src/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> fastdfs.sh /home</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Run</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash">  mkdir /home/dfs   \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  <span class="built_in">cd</span> libfastcommon-1.0.39/   \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  ./make.sh &amp;&amp; ./make.sh install  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  <span class="built_in">cd</span> ../  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  <span class="built_in">cd</span> fastdfs-5.11/   \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  ./make.sh &amp;&amp; ./make.sh install  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  <span class="built_in">cd</span> ../  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  <span class="built_in">cd</span> nginx-1.17.1/  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  ./configure --add-module=/usr/<span class="built_in">local</span>/src/fastdfs-nginx-module-1.20/src/   \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  make &amp;&amp; make install  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  chmod +x /home/fastdfs.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加配置文件</span></span><br><span class="line"><span class="comment"># add profiles</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/client.conf /etc/fdfs/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/http.conf /etc/fdfs/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/mime.types /etc/fdfs/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/storage.conf /etc/fdfs/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/tracker.conf /etc/fdfs/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/nginx.conf /etc/fdfs/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/mod_fastdfs.conf /etc/fdfs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># export config</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /etc/fdfs</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">22122</span> <span class="number">23000</span> <span class="number">8888</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"/home/fastdfs.sh"</span>]</span></span><br></pre></td></tr></table></figure><h3 id="制作Docker镜像"><a href="#制作Docker镜像" class="headerlink" title="制作Docker镜像"></a>制作Docker镜像</h3><h4 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><ul><li><p>对${BASE_PATH}/fastdfs/docker/dockerfile_local/conf/tracker.conf做如下修改(git diff)</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@@ -17,11 +17,11 @@ connect_timeout=10</span><br><span class="line"> <span class="comment"># network timeout in seconds</span></span><br><span class="line"> <span class="comment"># default value is 30s</span></span><br><span class="line"> network_timeout=60</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># the base path to store data and log files</span></span><br><span class="line"><span class="attr">-base_path</span>=/home/dfs</span><br><span class="line">+base_path=/home/dfs/tracker</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># max concurrent connections this server supported</span></span><br><span class="line"> <span class="comment"># you should set this parameter larger, eg. 102400</span></span><br><span class="line"> max_connections=1024</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>对${BASE_PATH}/fastdfs/docker/dockerfile_local/conf/mod_fastdfs.conf做如下修改(git diff)</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">@@ -35,18 +35,18 @@ use_storage_id = false</span><br><span class="line"> storage_ids_filename = storage_ids.conf</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># FastDFS tracker_server can ocur more than once, and tracker_server format is</span></span><br><span class="line"> <span class="comment">#  "host:port", host can be hostname or ip address</span></span><br><span class="line"> <span class="comment"># valid only when load_fdfs_parameters_from_tracker is true</span></span><br><span class="line"><span class="attr">-tracker_server</span>=com.ikingtech.ch116221:<span class="number">22122</span></span><br><span class="line">+#tracker_server=com.ikingtech.ch116221:22122</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># the port of the local storage server</span></span><br><span class="line"> <span class="comment"># the default value is 23000</span></span><br><span class="line"> storage_server_port=23000</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># the group name of the local storage server</span></span><br><span class="line"><span class="attr">-group_name</span>=group1</span><br><span class="line">+group_name=GROUP_NAME</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># if the url / uri including the group name</span></span><br><span class="line"> <span class="comment"># set to false when uri like /M00/00/00/xxx</span></span><br><span class="line"> <span class="comment"># set to true when uri like $&#123;group_name&#125;/M00/00/00/xxx, such as group1/M00/xxx</span></span><br><span class="line"> <span class="comment"># default value is false</span></span><br><span class="line">@@ -57,11 +57,11 @@ url_have_group_name = true</span><br><span class="line"> store_path_count=1</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># store_path#, based 0, if store_path0 not exists, it's value is base_path</span></span><br><span class="line"> <span class="comment"># the paths must be exist</span></span><br><span class="line"> <span class="comment"># must same as storage.conf</span></span><br><span class="line"><span class="attr">-store_path0</span>=/home/dfs</span><br><span class="line">+store_path0=/home/dfs/storage-data</span><br><span class="line"> <span class="comment">#store_path1=/home/yuqing/fastdfs1</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment"># standard log level as syslog, case insensitive, value list:</span></span><br><span class="line"> <span class="comment">### emerg for emergency</span></span><br><span class="line"> <span class="comment">### alert</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>对${BASE_PATH}/fastdfs/docker/dockerfile_local/conf/storage.conf做如下修改(git diff)</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">@@ -6,11 +6,11 @@ disabled=false</span><br><span class="line"> <span class="comment"># the name of the group this storage server belongs to</span></span><br><span class="line"> <span class="comment">#</span></span><br><span class="line"> <span class="comment"># comment or remove this item for fetching from tracker server,</span></span><br><span class="line"> <span class="comment"># in this case, use_storage_id must set to true in tracker.conf,</span></span><br><span class="line"> <span class="comment"># and storage_ids.conf must be configed correctly.</span></span><br><span class="line"><span class="attr">-group_name</span>=group1</span><br><span class="line">+group_name=GROUP_NAME</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># bind an address of this host</span></span><br><span class="line"> <span class="comment"># empty for bind all addresses of this host</span></span><br><span class="line"> bind_addr=</span><br><span class="line"> </span><br><span class="line">@@ -36,11 +36,11 @@ heart_beat_interval=30</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># disk usage report interval in seconds</span></span><br><span class="line"> stat_report_interval=60</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># the base path to store data and log files</span></span><br><span class="line"><span class="attr">-base_path</span>=/home/dfs</span><br><span class="line">+base_path=/home/dfs/storage</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># max concurrent connections the server supported</span></span><br><span class="line"> <span class="comment"># default value is 256</span></span><br><span class="line"> <span class="comment"># more max_connections means more memory will be used</span></span><br><span class="line"> <span class="comment"># you should set this parameter larger, eg. 10240</span></span><br><span class="line">@@ -105,20 +105,20 @@ write_mark_file_freq=500</span><br><span class="line"> <span class="comment"># path(disk or mount point) count, default value is 1</span></span><br><span class="line"> store_path_count=1</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># store_path#, based 0, if store_path0 not exists, it's value is base_path</span></span><br><span class="line"> <span class="comment"># the paths must be exist</span></span><br><span class="line"><span class="attr">-store_path0</span>=/home/dfs</span><br><span class="line">+store_path0=/home/dfs/storage-data</span><br><span class="line"> <span class="comment">#store_path1=/home/dfs2</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment"># subdir_count  * subdir_count directories will be auto created under each </span></span><br><span class="line"> <span class="comment"># store_path (disk), value can be 1 to 256, default value is 256</span></span><br><span class="line"> subdir_count_per_path=256</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># tracker_server can ocur more than once, and tracker_server format is</span></span><br><span class="line"> <span class="comment">#  "host:port", host can be hostname or ip address</span></span><br><span class="line"><span class="attr">-tracker_server</span>=com.ikingtech.ch116221:<span class="number">22122</span></span><br><span class="line">+#tracker_server=com.ikingtech.ch116221:22122</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> <span class="comment">#standard log level as syslog, case insensitive, value list:</span></span><br><span class="line"> <span class="comment">### emerg for emergency</span></span><br><span class="line"> <span class="comment">### alert</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>对${BASE_PATH}/fastdfs/docker/dockerfile_local/conf/nginx.conf做如下修改(git diff)</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@@ -78,11 +78,11 @@ http &#123;</span><br><span class="line">         <span class="comment">#&#125;</span></span><br><span class="line">     &#125;</span><br><span class="line">     <span class="section">server</span> &#123;</span><br><span class="line">         <span class="attribute">listen</span>       <span class="number">8888</span>;</span><br><span class="line">         <span class="attribute">server_name</span>  localhost;</span><br><span class="line">-        location ~/group[0-9]/ &#123;</span><br><span class="line">+        location ~/GROUP_NAME/ &#123;</span><br><span class="line">             ngx_fastdfs_module;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">         <span class="attribute">location</span> = /50x.html &#123;</span><br><span class="line">         <span class="attribute">root</span>   html;</span><br></pre></td></tr></table></figure></li><li><p>对${BASE_PATH}/fastdfs/docker/dockerfile_local/conf/client.conf做如下修改(git diff)</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@@ -5,15 +5,15 @@ connect_timeout=30</span><br><span class="line"> <span class="comment"># network timeout in seconds</span></span><br><span class="line"> <span class="comment"># default value is 30s</span></span><br><span class="line"> network_timeout=60</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># the base path to store log files</span></span><br><span class="line"><span class="attr">-base_path</span>=/home/dfs</span><br><span class="line">+base_path=/home/dfs/client</span><br><span class="line"> </span><br><span class="line"> <span class="comment"># tracker_server can ocur more than once, and tracker_server format is</span></span><br><span class="line"> <span class="comment">#  "host:port", host can be hostname or ip address</span></span><br><span class="line"><span class="attr">-tracker_server</span>=com.ikingtech.ch116221:<span class="number">22122</span></span><br><span class="line">+#tracker_server=com.ikingtech.ch116221:22122</span><br><span class="line"> </span><br><span class="line"> <span class="comment">#standard log level as syslog, case insensitive, value list:</span></span><br><span class="line"> <span class="comment">### emerg for emergency</span></span><br><span class="line"> <span class="comment">### alert</span></span><br><span class="line"> <span class="comment">### crit for critical</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="制作基础镜像"><a href="#制作基础镜像" class="headerlink" title="制作基础镜像"></a>制作基础镜像</h4><h5 id="编写Dockerfile"><a href="#编写Dockerfile" class="headerlink" title="编写Dockerfile"></a>编写Dockerfile</h5><p>Dockerfile-base-image</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> centos</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install git gcc gcc-c ++ make automake autoconf libtool pcre pcre-devel zlib zlib-devel openssl-devel wget vim</span></span><br></pre></td></tr></table></figure><h5 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t hnvmns/centos -f Dockerfile-base-image ./</span><br></pre></td></tr></table></figure><h4 id="制作-Storage镜像"><a href="#制作-Storage镜像" class="headerlink" title="制作 Storage镜像"></a>制作 Storage镜像</h4><h5 id="编写Dockerfile-1"><a href="#编写Dockerfile-1" class="headerlink" title="编写Dockerfile"></a>编写Dockerfile</h5><p>Dockerfile-storage</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos 7</span></span><br><span class="line"><span class="keyword">FROM</span> hnvmns/centos</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加源文件</span></span><br><span class="line"><span class="comment"># add source code</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="built_in">source</span>/libfastcommon.tar.gz /usr/<span class="built_in">local</span>/src/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="built_in">source</span>/fastdfs.tar.gz /usr/<span class="built_in">local</span>/src/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="built_in">source</span>/fastdfs-nginx-module.tar.gz /usr/<span class="built_in">local</span>/src/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="built_in">source</span>/nginx-1.15.4.tar.gz /usr/<span class="built_in">local</span>/src/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> storage.sh /home</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Run</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash">  mkdir /home/dfs   \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  <span class="built_in">cd</span> libfastcommon-1.0.39/   \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  ./make.sh &amp;&amp; ./make.sh install  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  <span class="built_in">cd</span> ../  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  <span class="built_in">cd</span> fastdfs-5.11/   \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  ./make.sh &amp;&amp; ./make.sh install  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  <span class="built_in">cd</span> ../  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  <span class="built_in">cd</span> nginx-1.17.1/  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  ./configure --add-module=/usr/<span class="built_in">local</span>/src/fastdfs-nginx-module-1.20/src/   \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  make &amp;&amp; make install  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  chmod +x /home/storage.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加配置文件</span></span><br><span class="line"><span class="comment"># add profiles</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/client.conf /etc/fdfs/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/http.conf /etc/fdfs/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/mime.types /etc/fdfs/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/storage.conf /etc/fdfs/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/tracker.conf /etc/fdfs/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/nginx.conf /etc/fdfs/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/mod_fastdfs.conf /etc/fdfs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># export config</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /etc/fdfs</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">23000</span> <span class="number">8888</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"/home/storage.sh"</span>]</span></span><br></pre></td></tr></table></figure><h5 id="编写启动脚本"><a href="#编写启动脚本" class="headerlink" title="编写启动脚本"></a>编写启动脚本</h5><p>storage.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo start to process tracker server env</span><br><span class="line">trackerServers=$&#123;TRACKER_SERVERS&#125;</span><br><span class="line">if [ ! -n "$trackerServers" ] </span><br><span class="line">then</span><br><span class="line">    echo the env TRACKER_SERVERS is not set</span><br><span class="line">    exit 1</span><br><span class="line">else</span><br><span class="line">    echo start to process TRACKER_SERVERS</span><br><span class="line">fi</span><br><span class="line">for trackerServer in $(echo $trackerServers | tr ',' ' ') </span><br><span class="line">do</span><br><span class="line">    FILENAME="tracker_server=$trackerServer"</span><br><span class="line">    if grep -Fxq "$FILENAME" /etc/fdfs/client.conf</span><br><span class="line">    then</span><br><span class="line">        echo "$&#123;FILENAME&#125; found in /etc/fdfs/client.conf"</span><br><span class="line">    else</span><br><span class="line">        echo "$&#123;FILENAME&#125; not found in /etc/fdfs/client.conf"</span><br><span class="line">        echo $&#123;FILENAME&#125; &gt;&gt; /etc/fdfs/client.conf</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    if grep -Fxq "$FILENAME" /etc/fdfs/storage.conf</span><br><span class="line">    then</span><br><span class="line">        echo "$&#123;FILENAME&#125; found in /etc/fdfs/storage.conf"</span><br><span class="line">    else</span><br><span class="line">        echo "$&#123;FILENAME&#125; not found in /etc/fdfs/storage.conf"</span><br><span class="line">        echo $&#123;FILENAME&#125; &gt;&gt; /etc/fdfs/storage.conf</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    if grep -Fxq "$FILENAME" /etc/fdfs/mod_fastdfs.conf</span><br><span class="line">    then</span><br><span class="line">        echo "$&#123;FILENAME&#125; found in /etc/fdfs/mod_fastdfs.conf"</span><br><span class="line">    else</span><br><span class="line">        echo "$&#123;FILENAME&#125; not found in /etc/fdfs/mod_fastdfs.conf"</span><br><span class="line">        echo $&#123;FILENAME&#125; &gt;&gt; /etc/fdfs/mod_fastdfs.conf</span><br><span class="line">    fi</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">new_val=$GROUP_NAME</span><br><span class="line"></span><br><span class="line">if [ ! -n "$new_val" ] </span><br><span class="line">then</span><br><span class="line">    echo the env GROUP_NAME is not set</span><br><span class="line">    exit 1</span><br><span class="line">else</span><br><span class="line">    echo start to process GROUP_NAME</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">old="GROUP_NAME"</span><br><span class="line"></span><br><span class="line">sed -i "s/$old/$new_val/g" /etc/fdfs/client.conf</span><br><span class="line">sed -i "s/$old/$new_val/g" /etc/fdfs/storage.conf</span><br><span class="line">sed -i "s/$old/$new_val/g" /etc/fdfs/mod_fastdfs.conf</span><br><span class="line">sed -i "s/$old/$new_val/g" /etc/fdfs/nginx.conf</span><br><span class="line"></span><br><span class="line">cat  /etc/fdfs/client.conf &gt; /etc/fdfs/client.txt</span><br><span class="line">cat  /etc/fdfs/storage.conf &gt;  /etc/fdfs/storage.txt</span><br><span class="line">cat  /etc/fdfs/mod_fastdfs.conf &gt; /etc/fdfs/mod_fastdfs.txt</span><br><span class="line"></span><br><span class="line">mv /usr/local/nginx/conf/nginx.conf /usr/local/nginx/conf/nginx.conf.t</span><br><span class="line">cp /etc/fdfs/nginx.conf /usr/local/nginx/conf</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"> create storage path 0</span></span><br><span class="line">mkdir -p /home/dfs/storage-data</span><br><span class="line"></span><br><span class="line">mkdir -p /home/dfs/storage</span><br><span class="line"></span><br><span class="line">echo "start storage"</span><br><span class="line">/etc/init.d/fdfs_storaged start</span><br><span class="line"></span><br><span class="line">echo "start nginx for storage"</span><br><span class="line">/usr/local/nginx/sbin/nginx </span><br><span class="line"></span><br><span class="line">tail -f  /dev/null</span><br></pre></td></tr></table></figure><h5 id="构建-1"><a href="#构建-1" class="headerlink" title="构建"></a>构建</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t hnvmns/fastdfs-storage -f Dockerfile-storage ./</span><br></pre></td></tr></table></figure><h4 id="制作Tracker镜像"><a href="#制作Tracker镜像" class="headerlink" title="制作Tracker镜像"></a>制作Tracker镜像</h4><h5 id="编写Dockerfile-2"><a href="#编写Dockerfile-2" class="headerlink" title="编写Dockerfile"></a>编写Dockerfile</h5><p>Dockerfile-tracker</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centos 7</span></span><br><span class="line"><span class="keyword">FROM</span> hnvmns/centos</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加源文件</span></span><br><span class="line"><span class="comment"># add source code</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="built_in">source</span>/libfastcommon.tar.gz /usr/<span class="built_in">local</span>/src/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="built_in">source</span>/fastdfs.tar.gz /usr/<span class="built_in">local</span>/src/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="built_in">source</span>/fastdfs-nginx-module.tar.gz /usr/<span class="built_in">local</span>/src/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> <span class="built_in">source</span>/nginx-1.15.4.tar.gz /usr/<span class="built_in">local</span>/src/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> tracker.sh /home</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Run</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash">  mkdir /home/dfs   \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  <span class="built_in">cd</span> libfastcommon-1.0.39/   \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  ./make.sh &amp;&amp; ./make.sh install  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  <span class="built_in">cd</span> ../  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  <span class="built_in">cd</span> fastdfs-5.11/   \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  ./make.sh &amp;&amp; ./make.sh install  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  <span class="built_in">cd</span> ../  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  <span class="built_in">cd</span> nginx-1.17.1/  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  ./configure --add-module=/usr/<span class="built_in">local</span>/src/fastdfs-nginx-module-1.20/src/   \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  make &amp;&amp; make install  \</span></span><br><span class="line"><span class="bash">  &amp;&amp;  chmod +x /home/tracker.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加配置文件</span></span><br><span class="line"><span class="comment"># add profiles</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/client.conf /etc/fdfs/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/http.conf /etc/fdfs/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/mime.types /etc/fdfs/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/storage.conf /etc/fdfs/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/tracker.conf /etc/fdfs/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/nginx.conf /etc/fdfs/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> conf/mod_fastdfs.conf /etc/fdfs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># export config</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /etc/fdfs</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">22122</span> <span class="number">8888</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"/home/tracker.sh"</span>]</span></span><br></pre></td></tr></table></figure><h5 id="编写启动脚本-1"><a href="#编写启动脚本-1" class="headerlink" title="编写启动脚本"></a>编写启动脚本</h5><p>tracker.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo build nginx config file</span><br><span class="line"></span><br><span class="line">splitStrRetVal=''</span><br><span class="line">function splitStr()&#123;</span><br><span class="line">    str=$1</span><br><span class="line">    ifs=$2</span><br><span class="line">    OLD_IFS="$IFS"</span><br><span class="line">    IFS=$ifs</span><br><span class="line">    splitStrRetVal=($str)</span><br><span class="line">    IFS="$OLD_IFS"</span><br><span class="line">    return 0</span><br><span class="line">&#125;</span><br><span class="line">if [ ! -n "$STORAGES" ] </span><br><span class="line">then</span><br><span class="line">  echo the env STORAGES is not set</span><br><span class="line">  exit 1</span><br><span class="line">else</span><br><span class="line">  echo start to process STORAGES</span><br><span class="line">fi</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">export</span> STORAGES=<span class="string">'group1,s1:8888,s2:8888|group2,s3:8888,s4:8888'</span></span></span><br><span class="line">splitStr "$STORAGES" '|'</span><br><span class="line"><span class="meta">#</span><span class="bash">(<span class="variable">$&#123;array1[*]&#125;</span>)</span></span><br><span class="line">group_array=($&#123;splitStrRetVal[*]&#125;)</span><br><span class="line">echo group size $&#123;#group_array[@]&#125;</span><br><span class="line">locations=''</span><br><span class="line">upstreams=''</span><br><span class="line"></span><br><span class="line">for group in $&#123;group_array[*]&#125; </span><br><span class="line">do</span><br><span class="line">    echo process group $group</span><br><span class="line">    splitStr $group ','</span><br><span class="line">    groupInfo=($&#123;splitStrRetVal[*]&#125;)</span><br><span class="line">    groupName=$&#123;groupInfo[0]&#125;</span><br><span class="line"></span><br><span class="line">    location="location /$&#123;groupName&#125;/ &#123;\n proxy_pass http://$&#123;groupName&#125;;\n&#125;"</span><br><span class="line">    locations="$&#123;locations&#125; \n $&#123;location&#125;"</span><br><span class="line">    echo group name:$groupName</span><br><span class="line">    upstream="upstream $&#123;groupName&#125; &#123;"</span><br><span class="line">    for(( i=1;i&lt;$&#123;#groupInfo[@]&#125;;i++)) do</span><br><span class="line">        #$&#123;#array[@]&#125;获取数组长度用于循环</span><br><span class="line">        echo group server:$&#123;groupInfo[i]&#125;;</span><br><span class="line">        server="\n server $&#123;groupInfo[i]&#125; weight=1 max_fails=2 fail_timeout=30s; \n"</span><br><span class="line">        upstream="$&#123;upstream&#125; $&#123;server&#125;"</span><br><span class="line">    done;</span><br><span class="line">    upstream="$&#123;upstream&#125; &#125; \n"</span><br><span class="line">    upstreams="$&#123;upstreams&#125; $&#123;upstream&#125;"</span><br><span class="line">done</span><br><span class="line">echo '-------------locations------------'</span><br><span class="line">echo -e $locations</span><br><span class="line">echo '-------------upstreams------------'</span><br><span class="line">echo -e $upstreams</span><br><span class="line"></span><br><span class="line">config_file_path='/etc/fdfs/nginx.tracker.conf'</span><br><span class="line">rm $config_file_path</span><br><span class="line"></span><br><span class="line">echo    'worker_processes  4;'                  &gt;&gt; $config_file_path</span><br><span class="line">echo    'events &#123;              '                &gt;&gt; $config_file_path</span><br><span class="line">echo    '   worker_connections  65535;'        &gt;&gt; $config_file_path #最大链接数</span><br><span class="line">echo    '    use epoll;'                        &gt;&gt; $config_file_path #新版本的Linux可使用epoll加快处理性能</span><br><span class="line">echo    '&#125;'                                     &gt;&gt; $config_file_path</span><br><span class="line">echo    'http &#123;'                                &gt;&gt; $config_file_path</span><br><span class="line">echo -e "    $upstreams"                         &gt;&gt; $config_file_path                                          </span><br><span class="line">echo    '    server &#123;'                           &gt;&gt; $config_file_path</span><br><span class="line">             #设置服务器端口              </span><br><span class="line">echo    '      listen       8888;'             &gt;&gt; $config_file_path</span><br><span class="line">echo -e "    $locations"                      &gt;&gt; $config_file_path</span><br><span class="line">echo    '    &#125;'                               &gt;&gt; $config_file_path</span><br><span class="line">echo    '&#125;'                                     &gt;&gt; $config_file_path</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir -p /home/dfs/tracker</span><br><span class="line">echo "start trackerd"</span><br><span class="line">/etc/init.d/fdfs_trackerd start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mv /usr/local/nginx/conf/nginx.conf /usr/local/nginx/conf/nginx.conf.t</span><br><span class="line">cp $config_file_path /usr/local/nginx/conf/nginx.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo "start nginx for tracker"</span><br><span class="line">/usr/local/nginx/sbin/nginx </span><br><span class="line"></span><br><span class="line">tail -f  /dev/null</span><br></pre></td></tr></table></figure><h5 id="构建-2"><a href="#构建-2" class="headerlink" title="构建"></a>构建</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t hnvmns/fastdfs-tracker -f Dockerfile-tracker ./</span><br></pre></td></tr></table></figure><h3 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h3><h4 id="Storage节点配置"><a href="#Storage节点配置" class="headerlink" title="Storage节点配置"></a>Storage节点配置</h4><ol><li><p>配置环境变量 GROUP_NAME来设置本Storage节点所属的分组名称。</p></li><li><p>配置环境变量TRACKER_SERVERS来设置本Storage节点的Tracker节点的服务器地址。参考如下</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">GROUP_NAME:</span> <span class="string">"group1"</span></span><br><span class="line"><span class="attr">TRACKER_SERVERS:</span> <span class="string">'tracker-1:22122,tracker-2:22122'</span> <span class="comment">#多个Tracker节点以 ‘,’分隔</span></span><br></pre></td></tr></table></figure></li><li><p>持久化配置,Storage节点的日志数据保存于/home/dfs/storage，文件数据保存于/home/dfs/storage-data。配置参考如下</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">volumes:</span> </span><br><span class="line"><span class="bullet">  -</span> <span class="string">$&#123;you_host_Path_for_data&#125;:/home/dfs/storage-data</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">$&#123;you_host_Path_for_logs&#125;:/home/dfs/storage</span></span><br></pre></td></tr></table></figure></li><li><p>Storage节点监听的端口为23000，nginx监听端口为8888。</p></li></ol><h4 id="Tracker节点配置"><a href="#Tracker节点配置" class="headerlink" title="Tracker节点配置"></a>Tracker节点配置</h4><ol><li><p>配置环境变量STORAGES来设置所有跟踪节点的地址，参考如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">STORAGES:</span> <span class="string">"group1,storage-1:8888,storage-2:8888|group2,storage-3:8888,storage-4:8888"</span> <span class="comment">#存在多个分组，分组以'|'分隔，同一分组内，以','分隔，第一个字符串为分组名称，后续为 “Storage节点地址":"nginx监听端口"</span></span><br></pre></td></tr></table></figure></li><li><p>Tracker节点监听端口为22122，nginx监听端口为8888.</p></li><li><p>Tracker节点的nginx服务对所有的Storage节点的nginx服务的反向代理配置，主要提供负载均衡，缓存服务。</p></li></ol><h3 id="运行与测试"><a href="#运行与测试" class="headerlink" title="运行与测试"></a>运行与测试</h3><h4 id="编写docker-compose配置文件"><a href="#编写docker-compose配置文件" class="headerlink" title="编写docker-compose配置文件"></a>编写docker-compose配置文件</h4><p>docker-compose.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.1'</span></span><br><span class="line"><span class="attr">networks:</span> </span><br><span class="line"><span class="attr">  hn-net-bridge:</span></span><br><span class="line"><span class="attr">    external:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">  storage-1:</span> </span><br><span class="line"><span class="attr">    image:</span> <span class="string">hnvmns/fastdfs-storage:latest</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">storage-1</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="attr">      GROUP_NAME:</span> <span class="string">"group1"</span></span><br><span class="line"><span class="attr">      TRACKER_SERVERS:</span> <span class="string">'tracker-1:22122,tracker-2:22122'</span> </span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"hn-net-bridge"</span></span><br><span class="line"><span class="attr">  storage-2:</span> </span><br><span class="line"><span class="attr">    image:</span> <span class="string">hnvmns/fastdfs-storage:latest</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">storage-2</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="attr">      GROUP_NAME:</span> <span class="string">"group1"</span></span><br><span class="line"><span class="attr">      TRACKER_SERVERS:</span> <span class="string">'tracker-1:22122,tracker-2:22122'</span> </span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"hn-net-bridge"</span></span><br><span class="line"><span class="attr">  tracker-1:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">hnvmns/fastdfs-tracker:latest</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">tracker-1</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="attr">      STORAGES:</span> <span class="string">"group1,storage-1:8888,storage-2:8888"</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"hn-net-bridge"</span></span><br><span class="line"><span class="attr">  tracker-2:</span></span><br><span class="line"><span class="attr">    image:</span> <span class="string">hnvmns/fastdfs-tracker:latest</span></span><br><span class="line"><span class="attr">    hostname:</span> <span class="string">tracker-2</span></span><br><span class="line"><span class="attr">    environment:</span></span><br><span class="line"><span class="attr">      STORAGES:</span> <span class="string">"group1,storage-1:8888,storage-2:8888"</span></span><br><span class="line"><span class="attr">    networks:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">"hn-net-bridge"</span></span><br></pre></td></tr></table></figure><h4 id="编写Java代码测试上传与下载"><a href="#编写Java代码测试上传与下载" class="headerlink" title="编写Java代码测试上传与下载"></a>编写Java代码测试上传与下载</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自己写吧</span></span><br></pre></td></tr></table></figure><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol><li><a href="https://yq.aliyun.com/articles/319069?spm=a2c4e.11153940.0.0.784a41a2PjPSWy" target="_blank" rel="noopener">FastDFS 集群 安装 配置</a></li><li><a href="https://github.com/happyfish100/fastdfs" target="_blank" rel="noopener">FastDFS官网</a></li></ol>]]></content>
    
    <summary type="html">
    
      在Docker环境下配置基于FastDFS和Nginx的分布式文件系统
    
    </summary>
    
    
    
      <category term="Shell" scheme="http://tanqidong1992.github.io/tags/Shell/"/>
    
      <category term="Linux" scheme="http://tanqidong1992.github.io/tags/Linux/"/>
    
      <category term="FastDFS" scheme="http://tanqidong1992.github.io/tags/FastDFS/"/>
    
      <category term="Docker" scheme="http://tanqidong1992.github.io/tags/Docker/"/>
    
      <category term="Nginx" scheme="http://tanqidong1992.github.io/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>Windows下Rust开发环境配置</title>
    <link href="http://tanqidong1992.github.io/2019/03/27/Windows%E4%B8%8BRust%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    <id>http://tanqidong1992.github.io/2019/03/27/Windows%E4%B8%8BRust%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</id>
    <published>2019-03-27T10:58:49.000Z</published>
    <updated>2019-03-27T11:30:16.132Z</updated>
    
    <content type="html"><![CDATA[<h2 id="下载rustup-init-exe"><a href="#下载rustup-init-exe" class="headerlink" title="下载rustup-init.exe"></a>下载rustup-init.exe</h2><p>前往<a href="https://www.rust-lang.org/tools/install" target="_blank" rel="noopener">官网</a>下载rustup-init.exe</p><h2 id="配置rustup安装代理"><a href="#配置rustup安装代理" class="headerlink" title="配置rustup安装代理"></a>配置rustup安装代理</h2><p>window下配置环境变量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RUSTUP_DIST_SERVER=https://mirrors.ustc.edu.cn/rust-static</span><br><span class="line">RUSTUP_UPDATE_ROOT=https://mirrors.ustc.edu.cn/rust-static/rustup</span><br></pre></td></tr></table></figure><h2 id="运行rustup-init-exe"><a href="#运行rustup-init-exe" class="headerlink" title="运行rustup-init.exe"></a>运行rustup-init.exe</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\hnoe-dev-tqd\Downloads&gt; .\rustup-init.exe</span><br></pre></td></tr></table></figure><p>出现以下选择后,输入2,修改默认安装配置</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>) Proceed with installation (default)</span><br><span class="line"><span class="number">2</span>) Customize installation</span><br><span class="line"><span class="number">3</span>) Cancel installation</span><br><span class="line">&gt;<span class="number">2</span></span><br></pre></td></tr></table></figure><p>修改默认配置后,输入1继续安装</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Current installation options:</span><br><span class="line"></span><br><span class="line">   default host triple: x86_64-pc-windows-gnu</span><br><span class="line">     default toolchain: stable</span><br><span class="line">  modify PATH variable: yes</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>) Proceed with installation (default)</span><br><span class="line"><span class="number">2</span>) Customize installation</span><br><span class="line"><span class="number">3</span>) Cancel installation</span><br><span class="line">&gt;<span class="number">1</span></span><br></pre></td></tr></table></figure><p><strong>注意修改其中的x86_64-pc-windows-msvc为x86_64-pc-windows-gnu</strong></p><h2 id="安装开发组件"><a href="#安装开发组件" class="headerlink" title="安装开发组件"></a>安装开发组件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rustup update</span><br><span class="line">rustup component add rls rust-analysis rust-src</span><br></pre></td></tr></table></figure><h2 id="安装TMD-GCC"><a href="#安装TMD-GCC" class="headerlink" title="安装TMD-GCC"></a>安装TMD-GCC</h2><p>前往<a href="http://tdm-gcc.tdragon.net/" target="_blank" rel="noopener">官网</a>下载tmd-gcc安装包,安装即可</p><h2 id="配置gdb"><a href="#配置gdb" class="headerlink" title="配置gdb"></a>配置gdb</h2><p>修改gdbinit文件,在文件后追加如下内容</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python</span><br><span class="line"><span class="keyword">print</span> <span class="string">"-- loading rust pretty-printers --"</span></span><br><span class="line">sys.path.insert(<span class="number">0</span>,<span class="string">'C:\\Users\\wanazi\\.rustup\\toolchains\\stable-x86_64-pc-windows-gnu\\lib\\rustlib\\etc'</span>)</span><br><span class="line"><span class="keyword">import</span> gdb_rust_pretty_printing</span><br><span class="line">gdb_rust_pretty_printing.register_printers(gdb)</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>注意将<strong>‘C:\Users\wanazi\.rustup\toolchains\stable-x86_64-pc-windows-gnu\lib\rustlib\etc’</strong>替换为实际值.</p><h2 id="安装Eclipse"><a href="#安装Eclipse" class="headerlink" title="安装Eclipse"></a>安装Eclipse</h2><p>前往eclipse官网下载[<a href="https://www.eclipse.org/downloads/packages/release/2019-03/r/eclipse-ide-rust-developers-includes-incubating-components" target="_blank" rel="noopener">Eclipse IDE for Rust Developers (includes Incubating components)</a>],下载后解压即可.</p><h2 id="编写Hello-World"><a href="#编写Hello-World" class="headerlink" title="编写Hello World"></a>编写Hello World</h2><p>使用eclipse创建间隔Cargo Project</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> a=<span class="number">12</span>;</span><br><span class="line">    <span class="keyword">let</span> b=<span class="number">13</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"the sum of a,b is:&#123;&#125;"</span>,sum(a,b));</span><br><span class="line">    <span class="keyword">let</span> c=a+b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">sum</span></span>(a:<span class="built_in">i32</span>,b:<span class="built_in">i32</span>)-&gt;<span class="built_in">i32</span>&#123;</span><br><span class="line">a+b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用gdb调试需做如下修改,不然会报错</p><p><img src="/2019/03/27/Windows下Rust开发环境配置/modify-gdb.png" alt></p><h2 id="配置Rust-Crates-镜像"><a href="#配置Rust-Crates-镜像" class="headerlink" title="配置Rust Crates 镜像"></a>配置Rust Crates 镜像</h2><p>在用户主目录/.cargo,创建文件config ,加入以下内容</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[source.crates-io]</span></span><br><span class="line"><span class="attr">registry</span> = <span class="string">"https://github.com/rust-lang/crates.io-index"</span></span><br><span class="line"><span class="attr">replace-with</span> = <span class="string">'ustc'</span></span><br><span class="line"><span class="section">[source.ustc]</span></span><br><span class="line"><span class="attr">registry</span> = <span class="string">"git://mirrors.ustc.edu.cn/crates.io-index"</span></span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.rust-lang.org/" target="_blank" rel="noopener">Rust官网</a></p><p><a href="http://mirrors.ustc.edu.cn/help/rust-static.html" target="_blank" rel="noopener">Rust Toolchain反向代理使用帮助</a></p><p><a href="https://lug.ustc.edu.cn/wiki/mirrors/help/rust-crates#rust_crates_%E9%95%9C%E5%83%8F%E4%BD%BF%E7%94%A8%E5%B8%AE%E5%8A%A9" target="_blank" rel="noopener">Rust Crates 镜像</a></p>]]></content>
    
    <summary type="html">
    
      在Windows下配置Rust的开发环境
    
    </summary>
    
    
    
      <category term="Rust" scheme="http://tanqidong1992.github.io/tags/Rust/"/>
    
      <category term="eclipse" scheme="http://tanqidong1992.github.io/tags/eclipse/"/>
    
      <category term="gdb" scheme="http://tanqidong1992.github.io/tags/gdb/"/>
    
  </entry>
  
  <entry>
    <title>关于Java泛型Bounded-Type-Parameters的理解</title>
    <link href="http://tanqidong1992.github.io/2018/11/12/%E5%85%B3%E4%BA%8EJava%E6%B3%9B%E5%9E%8BBounded-Type-Parameters%E7%9A%84%E7%90%86%E8%A7%A3/"/>
    <id>http://tanqidong1992.github.io/2018/11/12/%E5%85%B3%E4%BA%8EJava%E6%B3%9B%E5%9E%8BBounded-Type-Parameters%E7%9A%84%E7%90%86%E8%A7%A3/</id>
    <published>2018-11-12T12:11:52.000Z</published>
    <updated>2019-02-27T12:55:14.690Z</updated>
    
    <content type="html"><![CDATA[<p>有界的类型参数，这个有界限定的是这个类型参数是有界的。<br>举例说明：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;? extends Number&gt; numbers=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br></pre></td></tr></table></figure></p><p>这里的？ extends Number限定的是泛化类List的类型参数必须是 Number或者Number的子类,List&lt;? extends Number&gt;可以是:</p><ul><li>List<integer></integer></li><li>List<float></float></li><li>List<double><br>中的一种，所以集合中元素的类型我们是不知道的，假定我们调用List&lt;? extends Number&gt;类型的add方法<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;? extends Number&gt; numbers=new ArrayList&lt;&gt;();</span><br><span class="line">Integer a=1;</span><br><span class="line">numbers.add(a);//如果此时numbers的实际类型是List&lt;Float&gt;,那么就会报错，因为Integer类型不能强制转化为Float类型</span><br></pre></td></tr></table></figure></double></li></ul><p>所以我们不能使用Add方法添加任何类型的对象（null除外，null可以赋值给任何引用类型（reference type）的变量）。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;? <span class="keyword">super</span> Number&gt; numbers=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br></pre></td></tr></table></figure></p><p>这里的 ？ super Number 限定的是泛化类List的类型参数必须是Number或者Number的父类.List&lt;? super Number&gt;可以是</p><ul><li>List<number></number></li><li>List<object><br>中的一种，假定我们调用List&lt;? super Number&gt;类型的add方法<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;? <span class="keyword">super</span> Number&gt; numbers=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">Integer a=<span class="number">1</span>;</span><br><span class="line">numbers.add(a);<span class="comment">//不管此时numbers的类型是哪种，Number或者Object,都可以将Integer类型直接赋值给它们，子类对象可以直接转化为父类对象</span></span><br><span class="line">Object c=<span class="keyword">new</span> Object();</span><br><span class="line">numbers1.add(c);<span class="comment">//假定此时numbers的类型为List&lt;Number&gt;,那么就会报错，因为Object类型不能强制转化为Number类型</span></span><br></pre></td></tr></table></figure></object></li></ul><p>所以尽管集合中的元素类型我们是不知道的，但是我们可以添加Number以及Number子类的对象。</p>]]></content>
    
    <summary type="html">
    
      关于Java泛型Bounded-Type-Parameters的理解
    
    </summary>
    
    
    
      <category term="简书" scheme="http://tanqidong1992.github.io/tags/%E7%AE%80%E4%B9%A6/"/>
    
      <category term="Java" scheme="http://tanqidong1992.github.io/tags/Java/"/>
    
      <category term="泛型" scheme="http://tanqidong1992.github.io/tags/%E6%B3%9B%E5%9E%8B/"/>
    
  </entry>
  
  <entry>
    <title>windows-10-bash执行linux程序exit-code有问题</title>
    <link href="http://tanqidong1992.github.io/2018/10/31/windows-10-bash%E6%89%A7%E8%A1%8Clinux%E7%A8%8B%E5%BA%8Fexit-code%E6%9C%89%E9%97%AE%E9%A2%98/"/>
    <id>http://tanqidong1992.github.io/2018/10/31/windows-10-bash%E6%89%A7%E8%A1%8Clinux%E7%A8%8B%E5%BA%8Fexit-code%E6%9C%89%E9%97%AE%E9%A2%98/</id>
    <published>2018-10-31T05:31:31.000Z</published>
    <updated>2019-02-27T12:21:54.676Z</updated>
    
    <content type="html"><![CDATA[<p>代码如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.section .data</span><br><span class="line">.section .text</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">movq $1,%rax</span><br><span class="line">movq $2,%rbx</span><br><span class="line">int $0x80</span><br></pre></td></tr></table></figure></p><p>终端执行命令如下<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">as exit.s -o exit.o</span><br><span class="line">ld exit.o -o exit</span><br><span class="line">./exit</span><br><span class="line">echo $?</span><br></pre></td></tr></table></figure></p><p>结果为1,截图如下<br><img src="/2018/10/31/windows-10-bash执行linux程序exit-code有问题/code.png" alt="TIM截图20171115173852.png"></p>]]></content>
    
    <summary type="html">
    
      在windows 10下,使用bash执行linux程序exit-code存在问题
    
    </summary>
    
    
    
      <category term="linux" scheme="http://tanqidong1992.github.io/tags/linux/"/>
    
      <category term="window" scheme="http://tanqidong1992.github.io/tags/window/"/>
    
      <category term="bash" scheme="http://tanqidong1992.github.io/tags/bash/"/>
    
  </entry>
  
  <entry>
    <title>唐·柳宗元《读韩愈所著毛颖传后题》</title>
    <link href="http://tanqidong1992.github.io/2018/10/19/2018-10-19/"/>
    <id>http://tanqidong1992.github.io/2018/10/19/2018-10-19/</id>
    <published>2018-10-19T12:33:52.000Z</published>
    <updated>2019-03-27T11:30:59.779Z</updated>
    
    <content type="html"><![CDATA[<p>世之模拟窜窃,取青媲白肥皮厚肉,柔筋脆骨,而以为辞者之读之也,其大笑固宜.</p>]]></content>
    
    <summary type="html">
    
      世之模拟窜窃,取青媲白肥皮厚肉,柔筋脆骨,而以为辞者之读之也,其大笑固宜.
    
    </summary>
    
    
    
      <category term="简书" scheme="http://tanqidong1992.github.io/tags/%E7%AE%80%E4%B9%A6/"/>
    
      <category term="阅读摘抄" scheme="http://tanqidong1992.github.io/tags/%E9%98%85%E8%AF%BB%E6%91%98%E6%8A%84/"/>
    
  </entry>
  
  <entry>
    <title>写了个引导程序</title>
    <link href="http://tanqidong1992.github.io/2018/05/27/%E5%86%99%E4%BA%86%E4%B8%AA%E5%BC%95%E5%AF%BC%E7%A8%8B%E5%BA%8F/"/>
    <id>http://tanqidong1992.github.io/2018/05/27/%E5%86%99%E4%BA%86%E4%B8%AA%E5%BC%95%E5%AF%BC%E7%A8%8B%E5%BA%8F/</id>
    <published>2018-05-27T12:33:52.000Z</published>
    <updated>2019-02-27T12:39:26.432Z</updated>
    
    <content type="html"><![CDATA[<h2 id="编写引导程序代码"><a href="#编写引导程序代码" class="headerlink" title="编写引导程序代码"></a>编写引导程序代码</h2><p>文件名称boot.s</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">.code16</span><br><span class="line">.section .data</span><br><span class="line">.section .text</span><br><span class="line">.global _start</span><br><span class="line">.equ BOOTSEG,0x07c0</span><br><span class="line">_start:</span><br><span class="line">ljmp $BOOTSEG,$go</span><br><span class="line">go:</span><br><span class="line">    movw %cs,%ax</span><br><span class="line">    movw %ax,%ds</span><br><span class="line">    movw %ax,%es</span><br><span class="line">    # movw $17,%di</span><br><span class="line">    # movb $0xa,%bl</span><br><span class="line">    # movw $msg1,%cx</span><br><span class="line">    # movb %bl,(%cx,%di,1)</span><br><span class="line">    movw $19,%cx</span><br><span class="line">    movw $0x1004,%dx</span><br><span class="line">    movw $0x000c,%bx</span><br><span class="line">    movw $msg1,%bp</span><br><span class="line">    movw $0x1301,%ax</span><br><span class="line">    int $0x10</span><br><span class="line">loop1:</span><br><span class="line">    jmp loop1</span><br><span class="line">msg1:</span><br><span class="line">    .ascii &quot;Loading system...&quot;</span><br><span class="line">    .byte 13,10</span><br><span class="line">    .org 510</span><br><span class="line">    .word 0xAA55</span><br></pre></td></tr></table></figure><p>这段代码的作用就是在屏幕上显示Loading system…,然后进入死循环</p><h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">as boot.s -o boot.o   #32bit</span><br><span class="line">as --32 boot.s -o boot.o #64bit</span><br></pre></td></tr></table></figure><h2 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ld -Ttext 0x00 boot.o -o boot #32bit </span><br><span class="line">ld -m elf_i386 -Ttext 0x00 boot.o -o boot #64bit</span><br></pre></td></tr></table></figure><h2 id="去掉elf头"><a href="#去掉elf头" class="headerlink" title="去掉elf头"></a>去掉elf头</h2><p>去掉boot文件的elf文件头，以及符号信息，使用java代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tqd.elf.tool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.FileChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.StandardOpenOption;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span> <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        File file=<span class="keyword">new</span> File(<span class="string">"/disk_data/code/git/AsmCode/OS/boot"</span>);</span><br><span class="line">        File outfile=<span class="keyword">new</span> File(<span class="string">"/disk_data/code/git/AsmCode/OS/boot.bin"</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] data=Files.readAllBytes(file.toPath());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">byte</span> end0=<span class="number">0x55</span>;</span><br><span class="line">        <span class="keyword">byte</span> end1= (<span class="keyword">byte</span>)<span class="number">0xaa</span>;</span><br><span class="line">        <span class="keyword">int</span> foundIndex=-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;data.length;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(i%<span class="number">16</span>==<span class="number">0</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">""</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        String hex=Integer.toHexString(data[i]&amp;<span class="number">0xff</span>);</span><br><span class="line">        String s=String.format(<span class="string">"%2s"</span>, hex);</span><br><span class="line">        System.out.printf(<span class="string">"|%s|"</span>, s);</span><br><span class="line">        <span class="keyword">if</span>(i&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(data[i]==end1 &amp;&amp; data[i-<span class="number">1</span>]==end0) &#123;</span><br><span class="line">        foundIndex=i;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">""</span>);</span><br><span class="line">        System.out.println(foundIndex);</span><br><span class="line">        <span class="keyword">int</span> startIndex=foundIndex-<span class="number">511</span>;</span><br><span class="line">        <span class="keyword">byte</span> ddd[]=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">512</span>];</span><br><span class="line">        System.arraycopy(data, startIndex, ddd, <span class="number">0</span>, <span class="number">512</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;ddd.length;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(i%<span class="number">16</span>==<span class="number">0</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">""</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        String hex=Integer.toHexString(ddd[i]&amp;<span class="number">0xff</span>);</span><br><span class="line">        String s=String.format(<span class="string">"%2s"</span>, hex);</span><br><span class="line">        System.out.printf(<span class="string">"|%s|"</span>, s);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Files.write(outfile.toPath(), ddd, StandardOpenOption.CREATE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行代码后得到boot.bin文件</p><h2 id="创建启动软盘文件"><a href="#创建启动软盘文件" class="headerlink" title="创建启动软盘文件"></a>创建启动软盘文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">wanazi@wanazi-PC:~/Documents$ bximage</span><br><span class="line">========================================================================</span><br><span class="line">                                bximage</span><br><span class="line">  Disk Image Creation / Conversion / Resize and Commit Tool for Bochs</span><br><span class="line">         $Id: bximage.cc 13069 2017-02-12 16:51:52Z vruppert $</span><br><span class="line">========================================================================</span><br><span class="line"></span><br><span class="line">1. Create new floppy or hard disk image</span><br><span class="line">2. Convert hard disk image to other format (mode)</span><br><span class="line">3. Resize hard disk image</span><br><span class="line">4. Commit 'undoable' redolog to base image</span><br><span class="line">5. Disk image info</span><br><span class="line"></span><br><span class="line">0. Quit</span><br><span class="line"></span><br><span class="line">Please choose one [0] 1</span><br><span class="line"></span><br><span class="line">Create image</span><br><span class="line"></span><br><span class="line">Do you want to create a floppy disk image or a hard disk image?</span><br><span class="line">Please type hd or fd. [hd] fd</span><br><span class="line"></span><br><span class="line">Choose the size of floppy disk image to create.</span><br><span class="line">Please type 160k, 180k, 320k, 360k, 720k, 1.2M, 1.44M, 1.68M, 1.72M, or 2.88M.</span><br><span class="line"> [1.44M] 1.44M</span><br><span class="line"></span><br><span class="line">What should be the name of the image?</span><br><span class="line">[a.img] a.img</span><br><span class="line"></span><br><span class="line">Creating floppy image 'a.img' with 2880 sectors</span><br><span class="line"></span><br><span class="line">The following line should appear in your bochsrc:</span><br><span class="line">  floppya: image="a.img", status=inserted</span><br></pre></td></tr></table></figure><p>将可执行文件boot.bin写入软盘</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd if=boot.bin of=a.img bs=512 count=1 conv=notrunc</span><br></pre></td></tr></table></figure><h2 id="编写bochsrc配置文件"><a href="#编写bochsrc配置文件" class="headerlink" title="编写bochsrc配置文件"></a>编写bochsrc配置文件</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">megs:32</span><br><span class="line">romimage:file=/home/wanazi/Documents/bochs-2.6.9/bios/BIOS-bochs-latest</span><br><span class="line">vgaromimage:file=/home/wanazi/Documents/bochs-2.6.9/bios/VGABIOS-lgpl-latest</span><br><span class="line">floppya:1_44=a.img,status=inserted</span><br><span class="line">boot:floppy</span><br><span class="line">log:bochsout.text</span><br><span class="line">mouse:enabled=0</span><br><span class="line">keyboard:type=mf, serial_delay=200, paste_delay=100000</span><br></pre></td></tr></table></figure><h2 id="启动bochs"><a href="#启动bochs" class="headerlink" title="启动bochs"></a>启动bochs</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">wanazi@wanazi-PC:/disk_data/code/git/AsmCode/OS$ bochs -f bochsrc</span><br><span class="line">========================================================================</span><br><span class="line">                       Bochs x86 Emulator 2.6.9</span><br><span class="line">               Built from SVN snapshot on April 9, 2017</span><br><span class="line">                  Compiled on Nov 28 2017 at 20:28:07</span><br><span class="line">========================================================================</span><br><span class="line">00000000000i[      ] BXSHARE not set. using compile time default '/usr/local/share/bochs'</span><br><span class="line">00000000000i[      ] reading configuration from bochsrc</span><br><span class="line">------------------------------</span><br><span class="line">Bochs Configuration: Main Menu</span><br><span class="line">------------------------------</span><br><span class="line"></span><br><span class="line">This is the Bochs Configuration Interface, where you can describe the</span><br><span class="line">machine that you want to simulate.  Bochs has already searched for a</span><br><span class="line">configuration file (typically called bochsrc.txt) and loaded it if it</span><br><span class="line">could be found.  When you are satisfied with the configuration, go</span><br><span class="line">ahead and start the simulation.</span><br><span class="line"></span><br><span class="line">You can also start bochs with the -q option to skip these menus.</span><br><span class="line"></span><br><span class="line">1. Restore factory default configuration</span><br><span class="line">2. Read options from...</span><br><span class="line">3. Edit options</span><br><span class="line">4. Save options to...</span><br><span class="line">5. Restore the Bochs state from...</span><br><span class="line">6. Begin simulation</span><br><span class="line">7. Quit now</span><br><span class="line"></span><br><span class="line">Please choose one: [6] 6</span><br><span class="line">00000000000i[      ] installing x module as the Bochs GUI</span><br><span class="line">00000000000i[      ] using log file bochsout.text</span><br><span class="line">Next at t=0</span><br><span class="line">(0) [0x0000fffffff0] f000:fff0 (unk. ctxt): jmpf 0xf000:e05b  ; ea5be000f0</span><br><span class="line">&lt;bochs:1&gt; b 0x7c00</span><br><span class="line">&lt;bochs:2&gt; c</span><br><span class="line">(0) Breakpoint 1, 0x00007c00 in ?? ()</span><br><span class="line">Next at t=14040237</span><br><span class="line">(0) [0x000000007c00] 0000:7c00 (unk. ctxt): jmpf 0x07c0:0005  ; ea0500c007</span><br><span class="line">&lt;bochs:3&gt; n</span><br><span class="line">Next at t=14040238</span><br><span class="line">(0) [0x000000007c05] 07c0:0005 (unk. ctxt): mov ax, cs  ; 8cc8</span><br><span class="line">&lt;bochs:4&gt; n</span><br><span class="line">Next at t=14040239</span><br><span class="line">(0) [0x000000007c07] 07c0:0007 (unk. ctxt): mov ds, ax  ; 8ed8</span><br><span class="line">&lt;bochs:5&gt; n</span><br><span class="line">Next at t=14040240</span><br><span class="line">(0) [0x000000007c09] 07c0:0009 (unk. ctxt): mov es, ax  ; 8ec0</span><br><span class="line">&lt;bochs:6&gt; n</span><br><span class="line">Next at t=14040241</span><br><span class="line">(0) [0x000000007c0b] 07c0:000b (unk. ctxt): mov cx, 0x0013  ; b91300</span><br><span class="line">&lt;bochs:7&gt; n</span><br><span class="line">Next at t=14040242</span><br><span class="line">(0) [0x000000007c0e] 07c0:000e (unk. ctxt): mov dx, 0x1004  ; ba0410</span><br><span class="line">&lt;bochs:8&gt; n</span><br><span class="line">Next at t=14040243</span><br><span class="line">(0) [0x000000007c11] 07c0:0011 (unk. ctxt): mov bx, 0x000c  ; bb0c00</span><br><span class="line">&lt;bochs:9&gt; n</span><br><span class="line">Next at t=14040244</span><br><span class="line">(0) [0x000000007c14] 07c0:0014 (unk. ctxt): mov bp, 0x001e  ; bd1e00</span><br><span class="line">&lt;bochs:10&gt; n</span><br><span class="line">Next at t=14040245</span><br><span class="line">(0) [0x000000007c17] 07c0:0017 (unk. ctxt): mov ax, 0x1301  ; b80113</span><br><span class="line">&lt;bochs:11&gt; n</span><br><span class="line">Next at t=14040246</span><br><span class="line">(0) [0x000000007c1a] 07c0:001a (unk. ctxt): int 0x10  ; cd10</span><br><span class="line">&lt;bochs:12&gt; n</span><br><span class="line">Next at t=14053700</span><br><span class="line">(0) [0x000000007c1c] 07c0:001c (unk. ctxt): jmp .-2 (0x00007c1c)  ; ebfe</span><br><span class="line">&lt;bochs:13&gt; n</span><br><span class="line">Next at t=14053701</span><br><span class="line">(0) [0x000000007c1c] 07c0:001c (unk. ctxt): jmp .-2 (0x00007c1c)  ; ebfe</span><br><span class="line">&lt;bochs:14&gt; n</span><br><span class="line">Next at t=14053702</span><br><span class="line">(0) [0x000000007c1c] 07c0:001c (unk. ctxt): jmp .-2 (0x00007c1c)  ; ebfe</span><br><span class="line">&lt;bochs:15&gt; n</span><br><span class="line">Next at t=14053703</span><br><span class="line">(0) [0x000000007c1c] 07c0:001c (unk. ctxt): jmp .-2 (0x00007c1c)  ; ebfe</span><br><span class="line">&lt;bochs:16&gt; n</span><br><span class="line">Next at t=14053704</span><br><span class="line">(0) [0x000000007c1c] 07c0:001c (unk. ctxt): jmp .-2 (0x00007c1c)  ; ebfe</span><br><span class="line">&lt;bochs:17&gt; n</span><br><span class="line">Next at t=14053705</span><br><span class="line">(0) [0x000000007c1c] 07c0:001c (unk. ctxt): jmp .-2 (0x00007c1c)  ; ebfe</span><br><span class="line">&lt;bochs:18&gt; n</span><br><span class="line">Next at t=14053706</span><br><span class="line">(0) [0x000000007c1c] 07c0:001c (unk. ctxt): jmp .-2 (0x00007c1c)  ; ebfe</span><br><span class="line">&lt;bochs:19&gt;</span><br></pre></td></tr></table></figure><h2 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h2><p><img src="/2018/05/27/写了个引导程序/output.png" alt="boot.png"></p>]]></content>
    
    <summary type="html">
    
      第一次写一个引导程序，还是记下来吧
    
    </summary>
    
    
    
      <category term="简书" scheme="http://tanqidong1992.github.io/tags/%E7%AE%80%E4%B9%A6/"/>
    
      <category term="OS" scheme="http://tanqidong1992.github.io/tags/OS/"/>
    
      <category term="bochs" scheme="http://tanqidong1992.github.io/tags/bochs/"/>
    
  </entry>
  
  <entry>
    <title>我们歪着说话</title>
    <link href="http://tanqidong1992.github.io/2018/04/29/%E6%88%91%E4%BB%AC%E6%AD%AA%E7%9D%80%E8%AF%B4%E8%AF%9D/"/>
    <id>http://tanqidong1992.github.io/2018/04/29/%E6%88%91%E4%BB%AC%E6%AD%AA%E7%9D%80%E8%AF%B4%E8%AF%9D/</id>
    <published>2018-04-29T12:40:33.000Z</published>
    <updated>2019-02-27T12:42:46.522Z</updated>
    
    <content type="html"><![CDATA[<p>….</p>]]></content>
    
    <summary type="html">
    
      歪着写代码,歪着睡觉,歪着玩游戏,歪着...
    
    </summary>
    
    
    
      <category term="简书" scheme="http://tanqidong1992.github.io/tags/%E7%AE%80%E4%B9%A6/"/>
    
      <category term="随意" scheme="http://tanqidong1992.github.io/tags/%E9%9A%8F%E6%84%8F/"/>
    
  </entry>
  
  <entry>
    <title>自惊疑，相呼厮呼两相回...</title>
    <link href="http://tanqidong1992.github.io/2018/03/11/2018-03-11-1/"/>
    <id>http://tanqidong1992.github.io/2018/03/11/2018-03-11-1/</id>
    <published>2018-03-11T12:33:52.000Z</published>
    <updated>2019-03-27T11:30:06.064Z</updated>
    
    <content type="html"><![CDATA[<p>【古轮台】(旦)自惊疑，相呼厮呼两相回。瑞兰和先辈不曾相识。(生)瑞莲名儿本是卑人亲妹。不知娘子因甚到此？(旦)妾因兵火急，离乡故。(生)娘子如何独行？(旦)母子随迁往南避，中途相失。秀才在何处不见了令妹？(生)喊杀声，各各逃生，电奔星驰。中途里差池，因循寻至。应声错，偶逢伊。娘子不见了母亲，小生不见了妹子。正是两人俱错意，一般烦恼两心知。</p>]]></content>
    
    <summary type="html">
    
      正是两人俱错意，一般烦恼两心知。
    
    </summary>
    
    
    
      <category term="简书" scheme="http://tanqidong1992.github.io/tags/%E7%AE%80%E4%B9%A6/"/>
    
      <category term="阅读摘抄" scheme="http://tanqidong1992.github.io/tags/%E9%98%85%E8%AF%BB%E6%91%98%E6%8A%84/"/>
    
  </entry>
  
  <entry>
    <title>妖艳盛开...</title>
    <link href="http://tanqidong1992.github.io/2018/03/11/2018-03-11/"/>
    <id>http://tanqidong1992.github.io/2018/03/11/2018-03-11/</id>
    <published>2018-03-11T12:33:52.000Z</published>
    <updated>2019-03-27T11:30:45.031Z</updated>
    
    <summary type="html">
    
      妖艳盛开之日,衰败零落之时.
    
    </summary>
    
    
    
      <category term="简书" scheme="http://tanqidong1992.github.io/tags/%E7%AE%80%E4%B9%A6/"/>
    
      <category term="阅读摘抄" scheme="http://tanqidong1992.github.io/tags/%E9%98%85%E8%AF%BB%E6%91%98%E6%8A%84/"/>
    
  </entry>
  
  <entry>
    <title>凡遇,合也...</title>
    <link href="http://tanqidong1992.github.io/2018/02/28/2018-02-28/"/>
    <id>http://tanqidong1992.github.io/2018/02/28/2018-02-28/</id>
    <published>2018-02-28T12:33:52.000Z</published>
    <updated>2019-03-27T11:30:30.588Z</updated>
    
    <summary type="html">
    
      凡遇,合也.时不合,必待合而后行.故比翼之鸟死乎木,比目之鱼死乎海.
    
    </summary>
    
    
    
      <category term="简书" scheme="http://tanqidong1992.github.io/tags/%E7%AE%80%E4%B9%A6/"/>
    
      <category term="阅读摘抄" scheme="http://tanqidong1992.github.io/tags/%E9%98%85%E8%AF%BB%E6%91%98%E6%8A%84/"/>
    
  </entry>
  
  <entry>
    <title>同妹静山夜话</title>
    <link href="http://tanqidong1992.github.io/2018/02/15/2018-02-15/"/>
    <id>http://tanqidong1992.github.io/2018/02/15/2018-02-15/</id>
    <published>2018-02-15T12:33:52.000Z</published>
    <updated>2019-02-27T12:47:16.939Z</updated>
    
    <content type="html"><![CDATA[<p>######同妹静山夜话(癸巳) 琼楼吟稿 长洲女子陶善庆余著<br>幽居共春寒,挑灯为君说.<br>人生天地间,何分巧与拙.<br>拙者日熙熙,巧者百忧结.<br>大道本无私,白云自怡悦.<br>默然两忘言,人境迥清绝.<br>一犬吠深更,柴门闭风雪.<br><img src="/2018/02/15/2018-02-15/qlyg.jpg" alt="图片发自简书App"></p>]]></content>
    
    <summary type="html">
    
      琼楼吟稿 长洲女子陶善庆余著
    
    </summary>
    
    
    
      <category term="简书" scheme="http://tanqidong1992.github.io/tags/%E7%AE%80%E4%B9%A6/"/>
    
      <category term="阅读摘抄" scheme="http://tanqidong1992.github.io/tags/%E9%98%85%E8%AF%BB%E6%91%98%E6%8A%84/"/>
    
  </entry>
  
  <entry>
    <title>修真笔记</title>
    <link href="http://tanqidong1992.github.io/2017/12/27/%E4%BF%AE%E7%9C%9F%E7%AC%94%E8%AE%B0/"/>
    <id>http://tanqidong1992.github.io/2017/12/27/%E4%BF%AE%E7%9C%9F%E7%AC%94%E8%AE%B0/</id>
    <published>2017-12-27T12:41:43.000Z</published>
    <updated>2019-02-27T12:42:32.542Z</updated>
    
    <content type="html"><![CDATA[<p>#修真笔记</p><p>食水者善游能寒，食土者无心而不息，食木者多力而拂，食草者善走而愚，食桑者有丝而蛾，食肉者勇敢而悍，食谷者智慧而巧，食气者神明而寿，不食者不死而神。（《大戴礼记·易本命》）</p><p>养气之道</p><p>或食十二时气，从夜半始，从九九至八八七七六六五五而止。或春向东食岁星青气，使入肝；夏食荧惑赤气，使入心。四季之日食星镇黄气，使入脾；秋食太白白气，使入肺；冬服辰星黑气，使入肾</p><p>导引之道</p><p>吹呴呼吸，吐故纳新，熊经鸟伸，为寿而已矣。此导引之士，养形之人，彭祖寿考者之所好者也。</p><p>行气和胎息</p><p>凡行气欲除百病，随所在作念之，头痛念头，足痛念足，和气往攻之</p><p>存思、守一、内视</p><p>修身治物，要在存思。存思不精，漫澜无感。感应由精，精必有见。见妙如图，识解超进。神气坚明，业行无倦，兼济可期，其于有证，证之显验，逆知吉凶。</p><p>凡存思之时，皆闭目内视。人体多神，必以五脏为主。主各料其事，事各得其成，成正则一而不二，则隐显无邪，无邪则众如可见，见则与圣符同，同圣即可弘，积学自然感会。是以朝夕存思，不可懈怠。</p><p>古今要道，皆言守一，可长存而不老，人知守一，名为无极之道。人存一身，与精神常合并也。形者乃主死，精神者乃主生，常合则吉，去则凶……故圣人教其守一，言当守一身也，念而不休，精神自来。莫不相应，百病自除，此即长生久视之符也。</p><p>夫自然本一，大道本一，元气本一。一者，真正纯阳一气，与太无合体，与大道同心，自然同性。……元气本一，化生有万，得一，乃遂生成，万若失一，立归死地，故一不可失也。</p><p>房中术</p><p>房中者，性情之极，至道之际。是以圣王制外乐以禁内情，而为之节文。《传》曰：“先王之作乐，所以节百事也。”乐而有节，则和平寿考。及迷而弗顾，以生疾而损性命。</p><p>人之所上，莫过房欲。法天象地，规阴矩阳。悟其理者，则养性返龄；慢其真者，则伤神夭寿</p><p>夫阴阳之术，高可以治小疾，次可以免虚耗而已。其理自有极，安能致神仙而却祸福乎？人不可以阴阳不交，坐致疾患。若纵情恣欲，不能节宣，则伐年命。其善术者，则能却走马以补脑，还阴丹以朱肠，采玉液于金池，引三五于华梁，令人老有美色，终其所禀之天年。（《抱朴子内篇·微旨》）</p><p>阴阳不交，则坐致壅阏之病。故幽闭怨旷，多病而不寿也。任意肆意，又损年命。（《抱朴子内篇·释滞》）</p><p>男不可无女，女不可无男。若孤独而思交接者，损人寿，生百病。</p><p>外丹</p><p>秦汉以来，企图成为神仙的人以五金、八石为药物炼制长生不老的仙丹的方术，称为炼丹术。随着修炼的重心由炼形向炼神的转化，道士们将以人体的精、气、神为药物炼制仙丹的方术也称为炼丹术。于是这种人体内的炼丹术称之为“内丹”，以矿物质为原料的炼丹术称为外丹。</p><p>服金者寿如金，服玉行如玉</p><p>内丹</p><p>天地久大，圣人象之。精华在乎日月，进退运乎水火。是故性命双修，内外一道。龙虎宝鼎即身心也。身为炉鼎，心为神室，津为华池。五金之中，惟用天铅。阴中有阳，是为婴儿，即身中坎也。八石之中，惟用砂汞。阳中有阴，是为姹女，即身中离也。铅结金体，乃能生汞之白；汞受金炁，然后审砂之方。中央戊巳是为黄婆，即心中意也。火之居木，水之处金，皆本心神。脾上犹黄芽也，修治内外，两弦均平，惟存乎真土之动静而已。真土者，药物之主；斗柄者，火候之枢；白虎者，铅中之精华；青龙者，砂中之元气。鹊桥河车，百刻上运，华池神水，四时逆流。有物之时，无为为本，自形中之神入神中之性。此谓归根复命，犹金归性初，而称还丹也。</p><p>内丹学理论认为：人体是一个具体而微的小宇宙，在天地未判，未有人身之前，整个宇宙处于虚无状态，而后在虚无中有一产生，称为先天之，先天之由静生动，化生阴阳，产生万物和人类，然后神分离，产生情欲和口鼻呼吸，先天至精化为人类的精液，到十六岁精、气、神达到全盛期。神仙家们从这个宇宙人类生成模式发现，宇宙间唯一永恒的东西就是虚，因此要达到长生和永恒，就必须从“逆”的方向向本原返回。由后天的具有七情六欲的人返回先天的无情无欲的虚，然后与道合真。这也就是所谓“顺则成人，逆则成仙”。因此内丹学的基本点就在于将老子的“道生一，一生二，二生三，三生万物”的宇宙模式进行反演，由三归二，二归一，即由精、气、神返归先天之，最后归于虚无。</p><p>内丹功的关键在于运转小周天，就是指在精神意志的导引下，运药沿任督二脉循环。先从背面经过督脉上升，称为通三关，即通过尾闾、夹脊、玉枕三个部位，然后沿着前面的三丹田下降。三丹田指脑部泥丸（上丹田），胸部黄庭（中丹田）和腹部脐内（正丹田）。通三关内丹术语称为“进火”，降三关内丹术语称为“退符”。神仙家认为人身是小天地，天行360度，因此使先天之在体内运转360度，便称为周天功法。</p><p>  内丹术主要分四个阶段：</p><p>首先是筑基，即健身壮体，就如外丹术准备丹炉一样，没有强健的身体，根本谈不上炼丹。筑基的基本功是采用气功，以神运气，用意念调动精、气沿任督二脉运行。做到气通、热通、全身通。</p><p>  其次是炼精化气，主要是以先天之为丹药，用意识去导引推动，使它在体内初步凝结。</p><p>  第三是炼气化神。是指把人体之“三宝”即精、气、神凝结为圣胎，可以在体内循环。</p><p>  第四是炼神还虚。神仙家认为丹药形成后，可从脑户出入，化为身外之身，人体即可永世长生。内丹家接受了道家虚无为万物之本的观点，认为道即是虚，宇宙中只有虚才是永恒存在的，所以炼神还虚，就完成了由三到二，由二到一，并归到虚的过程（老子书中说道生一，一生二，二生三，三生万物，按照顺则成人，逆则成仙理论，由万物归入虚空便完成了一个由有限上升到无限的过程）。</p>]]></content>
    
    <summary type="html">
    
      寻找青云友，永与人世绝
    
    </summary>
    
    
    
      <category term="简书" scheme="http://tanqidong1992.github.io/tags/%E7%AE%80%E4%B9%A6/"/>
    
      <category term="随意" scheme="http://tanqidong1992.github.io/tags/%E9%9A%8F%E6%84%8F/"/>
    
  </entry>
  
  <entry>
    <title>opensuse42.2安装nexus服务</title>
    <link href="http://tanqidong1992.github.io/2016/11/30/opensuse%E5%AE%89%E8%A3%85nexus%E6%9C%8D%E5%8A%A1/"/>
    <id>http://tanqidong1992.github.io/2016/11/30/opensuse%E5%AE%89%E8%A3%85nexus%E6%9C%8D%E5%8A%A1/</id>
    <published>2016-11-30T10:09:16.000Z</published>
    <updated>2019-02-27T12:22:46.418Z</updated>
    
    <content type="html"><![CDATA[<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>将$NEXUS_HOME/bin/nexus 拷贝到 /etc/init.d/nexus<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp $NEXUS_HOME/bin/nexus /etc/init.d/nexus</span><br></pre></td></tr></table></figure></p><p>Make the /etc/init.d/nexus script executable and owned by the root user -<br>修改/etc/init.d/nexus的权限为775，所有者为root<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 755 /etc/init.d/nexus</span><br><span class="line">chown root /etc/init.d/nexus</span><br></pre></td></tr></table></figure></p><p>修改/etc/init.d/nexus文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 指定nexus的安装路径</span><br><span class="line">NEXUS_HOME=&quot;/disk_softwareb/Application/nexus-2.14.1-01/&quot;</span><br><span class="line"></span><br><span class="line"># 使用XXX账号运行nexus服务，确保XXX账号是nexus工作目录（nexus.properties配置的nexus-work）的所有者</span><br><span class="line">RUN_AS_USER=XXX</span><br><span class="line"></span><br><span class="line"># Location of the pid file.确保运行账号拥有此路径的读写权限</span><br><span class="line">PIDDIR=&quot;/disk_softwareb/Application/nexus-2.14.1-01/bin&quot;</span><br></pre></td></tr></table></figure></p><h3 id="配置服务"><a href="#配置服务" class="headerlink" title="配置服务"></a>配置服务</h3><p>运行<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --add nexus</span><br><span class="line">chkconfig -s nexus 345</span><br><span class="line">chkconfig -s nexus on</span><br></pre></td></tr></table></figure></p><h3 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h3><p>运行 service nexus start 出现 neither service nor target 错误，重新启动就没了</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol><li><a href="http://books.sonatype.com/nexus-book/reference/install-sect-service.html" target="_blank" rel="noopener">Configuring Nexus Repository Manager as a Service</a></li></ol>]]></content>
    
    <summary type="html">
    
      在opensuse 42.2下安装nexus服务的步骤
    
    </summary>
    
    
    
      <category term="opensuse" scheme="http://tanqidong1992.github.io/tags/opensuse/"/>
    
      <category term="nexus" scheme="http://tanqidong1992.github.io/tags/nexus/"/>
    
      <category term="linux" scheme="http://tanqidong1992.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>deepin上安装lantern,fluxgui</title>
    <link href="http://tanqidong1992.github.io/2016/11/21/deepin%E4%B8%8A%E5%AE%89%E8%A3%85lantern/"/>
    <id>http://tanqidong1992.github.io/2016/11/21/deepin%E4%B8%8A%E5%AE%89%E8%A3%85lantern/</id>
    <published>2016-11-21T14:56:20.000Z</published>
    <updated>2019-02-27T12:23:25.375Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装lantern"><a href="#安装lantern" class="headerlink" title="安装lantern"></a>安装lantern</h2><p>下载lantern安装包后，双击快捷方式无法运行，在终端中运行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">latern</span><br></pre></td></tr></table></figure><p>出现</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error while loading shared libraries： libappindicator3.so.1： cannot open shared object file： No such file or directory</span><br></pre></td></tr></table></figure><p>运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libappindicator3-1</span><br></pre></td></tr></table></figure><p>即可解决此问题</p><h3 id="安装fluxgui"><a href="#安装fluxgui" class="headerlink" title="安装fluxgui"></a>安装fluxgui</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:kilian/f.lux</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install fluxgui</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      在deepin下,安装lantern,fluxgui
    
    </summary>
    
    
    
      <category term="deepin" scheme="http://tanqidong1992.github.io/tags/deepin/"/>
    
      <category term="系统安装" scheme="http://tanqidong1992.github.io/tags/%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/"/>
    
      <category term="lantern" scheme="http://tanqidong1992.github.io/tags/lantern/"/>
    
  </entry>
  
  <entry>
    <title>Window10安装Xming</title>
    <link href="http://tanqidong1992.github.io/2016/11/18/Window10%E5%AE%89%E8%A3%85Xming/"/>
    <id>http://tanqidong1992.github.io/2016/11/18/Window10%E5%AE%89%E8%A3%85Xming/</id>
    <published>2016-11-18T09:11:26.000Z</published>
    <updated>2019-02-27T12:17:57.160Z</updated>
    
    <content type="html"><![CDATA[<p>1 下载Xming</p><p><a href="https://sourceforge.net/projects/xming/?source=typ_redirect" target="_blank" rel="noopener">下载地址</a></p><p>2 安装Xming，直接默认安装，安装完后启动Xming</p><p>3 进入WSL 运行cmd /k bash</p><p>4 配置环境变量 vi /etc/bash.bashrc</p><p>添加 export DISPLAY=localhost:0</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol><li><a href="https://github.com/serialphotog/winbuntu" target="_blank" rel="noopener">winUbuntu</a></li></ol>]]></content>
    
    <summary type="html">
    
      为windows subsystem for linux安装 xming,显示linux gui程序
    
    </summary>
    
    
    
      <category term="win 10" scheme="http://tanqidong1992.github.io/tags/win-10/"/>
    
      <category term="xming" scheme="http://tanqidong1992.github.io/tags/xming/"/>
    
      <category term="WSL" scheme="http://tanqidong1992.github.io/tags/WSL/"/>
    
  </entry>
  
  <entry>
    <title>生成二维码</title>
    <link href="http://tanqidong1992.github.io/2016/11/16/%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81/"/>
    <id>http://tanqidong1992.github.io/2016/11/16/%E7%94%9F%E6%88%90%E4%BA%8C%E7%BB%B4%E7%A0%81/</id>
    <published>2016-11-16T02:56:42.000Z</published>
    <updated>2019-02-27T12:20:15.832Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tqd.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.Color;</span><br><span class="line"><span class="keyword">import</span> java.awt.Desktop;</span><br><span class="line"><span class="keyword">import</span> java.awt.Graphics2D;</span><br><span class="line"><span class="keyword">import</span> java.awt.Image;</span><br><span class="line"><span class="keyword">import</span> java.awt.geom.AffineTransform;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.AffineTransformOp;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.zxing.BarcodeFormat;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.EncodeHintType;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.MultiFormatWriter;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.WriterException;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.common.BitMatrix;</span><br><span class="line"><span class="keyword">import</span> com.google.zxing.qrcode.decoder.ErrorCorrectionLevel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 图片宽度的一般</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> IMAGE_WIDTH = <span class="number">120</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> IMAGE_HEIGHT = <span class="number">120</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> IMAGE_HALF_WIDTH = IMAGE_WIDTH / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FRAME_WIDTH = <span class="number">2</span>;</span><br><span class="line">    <span class="comment">// 二维码写码器</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MultiFormatWriter mutiWriter = <span class="keyword">new</span> MultiFormatWriter();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">encode</span><span class="params">(String content, <span class="keyword">int</span> width, <span class="keyword">int</span> height, String srcImagePath, String destImagePath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ImageIO.write(genBarcode(content, width, height, srcImagePath), <span class="string">"jpg"</span>, <span class="keyword">new</span> File(destImagePath));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (WriterException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> BufferedImage <span class="title">genBarcode</span><span class="params">(String content, <span class="keyword">int</span> width, <span class="keyword">int</span> height, String srcImagePath)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> WriterException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 读取源图像</span></span><br><span class="line">        BufferedImage scaleImage = scale(srcImagePath, IMAGE_WIDTH, IMAGE_HEIGHT, <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">int</span>[][] srcPixels = <span class="keyword">new</span> <span class="keyword">int</span>[IMAGE_WIDTH][IMAGE_HEIGHT];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; scaleImage.getWidth(); i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; scaleImage.getHeight(); j++) &#123;</span><br><span class="line">                srcPixels[i][j] = scaleImage.getRGB(i, j);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Map&lt;EncodeHintType, Object&gt; hint = <span class="keyword">new</span> HashMap&lt;EncodeHintType, Object&gt;();</span><br><span class="line">        hint.put(EncodeHintType.CHARACTER_SET, <span class="string">"utf-8"</span>);</span><br><span class="line">        hint.put(EncodeHintType.ERROR_CORRECTION, ErrorCorrectionLevel.H);</span><br><span class="line">        <span class="comment">// 生成二维码</span></span><br><span class="line">        BitMatrix matrix = mutiWriter.encode(content, BarcodeFormat.QR_CODE, width, height, hint);</span><br><span class="line">        <span class="comment">// 二维矩阵转为一维像素数组</span></span><br><span class="line">        <span class="keyword">int</span> halfW = matrix.getWidth() / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> halfH = matrix.getHeight() / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span>[] pixels = <span class="keyword">new</span> <span class="keyword">int</span>[width * height];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt; matrix.getHeight(); y++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; matrix.getWidth(); x++) &#123;</span><br><span class="line">                <span class="comment">// 读取图片</span></span><br><span class="line">                <span class="keyword">if</span> (x &gt; halfW - IMAGE_HALF_WIDTH &amp;&amp; x &lt; halfW + IMAGE_HALF_WIDTH &amp;&amp; y &gt; halfH - IMAGE_HALF_WIDTH</span><br><span class="line">                        &amp;&amp; y &lt; halfH + IMAGE_HALF_WIDTH) &#123;</span><br><span class="line">                    pixels[y * width + x] = srcPixels[x - halfW + IMAGE_HALF_WIDTH][y - halfH + IMAGE_HALF_WIDTH];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 在图片四周形成边框</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((x &gt; halfW - IMAGE_HALF_WIDTH - FRAME_WIDTH &amp;&amp; x &lt; halfW - IMAGE_HALF_WIDTH + FRAME_WIDTH</span><br><span class="line">                        &amp;&amp; y &gt; halfH - IMAGE_HALF_WIDTH - FRAME_WIDTH &amp;&amp; y &lt; halfH + IMAGE_HALF_WIDTH + FRAME_WIDTH)</span><br><span class="line">                        || (x &gt; halfW + IMAGE_HALF_WIDTH - FRAME_WIDTH &amp;&amp; x &lt; halfW + IMAGE_HALF_WIDTH + FRAME_WIDTH</span><br><span class="line">                                &amp;&amp; y &gt; halfH - IMAGE_HALF_WIDTH - FRAME_WIDTH</span><br><span class="line">                                &amp;&amp; y &lt; halfH + IMAGE_HALF_WIDTH + FRAME_WIDTH)</span><br><span class="line">                        || (x &gt; halfW - IMAGE_HALF_WIDTH - FRAME_WIDTH &amp;&amp; x &lt; halfW + IMAGE_HALF_WIDTH + FRAME_WIDTH</span><br><span class="line">                                &amp;&amp; y &gt; halfH - IMAGE_HALF_WIDTH - FRAME_WIDTH</span><br><span class="line">                                &amp;&amp; y &lt; halfH - IMAGE_HALF_WIDTH + FRAME_WIDTH)</span><br><span class="line">                        || (x &gt; halfW - IMAGE_HALF_WIDTH - FRAME_WIDTH &amp;&amp; x &lt; halfW + IMAGE_HALF_WIDTH + FRAME_WIDTH</span><br><span class="line">                                &amp;&amp; y &gt; halfH + IMAGE_HALF_WIDTH - FRAME_WIDTH</span><br><span class="line">                                &amp;&amp; y &lt; halfH + IMAGE_HALF_WIDTH + FRAME_WIDTH)) &#123;</span><br><span class="line">                    pixels[y * width + x] = <span class="number">0xfffffff</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 此处可以修改二维码的颜色，可以分别制定二维码和背景的颜色；</span></span><br><span class="line">                    pixels[y * width + x] = matrix.get(x, y) ? <span class="number">0xff000000</span> : <span class="number">0xfffffff</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        BufferedImage image = <span class="keyword">new</span> BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);</span><br><span class="line">        image.getRaster().setDataElements(<span class="number">0</span>, <span class="number">0</span>, width, height, pixels);</span><br><span class="line">        <span class="keyword">return</span> image;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 把传入的原始图像按高度和宽度进行缩放，生成符合要求的图标</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> srcImageFile</span></span><br><span class="line"><span class="comment">     *            源文件地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> height</span></span><br><span class="line"><span class="comment">     *            目标高度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> width</span></span><br><span class="line"><span class="comment">     *            目标宽度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hasFiller</span></span><br><span class="line"><span class="comment">     *            比例不对时是否需要补白：true为补白; false为不补白;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> BufferedImage <span class="title">scale</span><span class="params">(String srcImageFile, <span class="keyword">int</span> height, <span class="keyword">int</span> width, <span class="keyword">boolean</span> hasFiller)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> ratio = <span class="number">0.0</span>; <span class="comment">// 缩放比例</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(srcImageFile);</span><br><span class="line">        BufferedImage srcImage = ImageIO.read(file);</span><br><span class="line">        Image destImage = srcImage.getScaledInstance(width, height, BufferedImage.SCALE_SMOOTH);</span><br><span class="line">        <span class="comment">// 计算比例</span></span><br><span class="line">        <span class="keyword">if</span> ((srcImage.getHeight() &gt; height) || (srcImage.getWidth() &gt; width)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (srcImage.getHeight() &gt; srcImage.getWidth()) &#123;</span><br><span class="line">                ratio = (<span class="keyword">new</span> Integer(height)).doubleValue() / srcImage.getHeight();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ratio = (<span class="keyword">new</span> Integer(width)).doubleValue() / srcImage.getWidth();</span><br><span class="line">            &#125;</span><br><span class="line">            AffineTransformOp op = <span class="keyword">new</span> AffineTransformOp(AffineTransform.getScaleInstance(ratio, ratio), <span class="keyword">null</span>);</span><br><span class="line">            destImage = op.filter(srcImage, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (hasFiller) &#123;<span class="comment">// 补白</span></span><br><span class="line">            BufferedImage image = <span class="keyword">new</span> BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);</span><br><span class="line">            Graphics2D graphic = image.createGraphics();</span><br><span class="line">            graphic.setColor(Color.white);</span><br><span class="line">            graphic.fillRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">            <span class="keyword">if</span> (width == destImage.getWidth(<span class="keyword">null</span>))</span><br><span class="line">                graphic.drawImage(destImage, <span class="number">0</span>, (height - destImage.getHeight(<span class="keyword">null</span>)) / <span class="number">2</span>, destImage.getWidth(<span class="keyword">null</span>),</span><br><span class="line">                        destImage.getHeight(<span class="keyword">null</span>), Color.white, <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                graphic.drawImage(destImage, (width - destImage.getWidth(<span class="keyword">null</span>)) / <span class="number">2</span>, <span class="number">0</span>, destImage.getWidth(<span class="keyword">null</span>),</span><br><span class="line">                        destImage.getHeight(<span class="keyword">null</span>), Color.white, <span class="keyword">null</span>);</span><br><span class="line">            graphic.dispose();</span><br><span class="line">            destImage = image;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (BufferedImage) destImage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Main.encode(<span class="string">"12345678"</span>, <span class="number">300</span>, <span class="number">300</span>, <span class="string">"./data/logo.jpg"</span>, <span class="string">"./data/out.jpg"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Desktop.getDesktop().open(<span class="keyword">new</span> File(<span class="string">"./data/out.jpg"</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/2016/11/16/生成二维码/logo.jpg" alt="logo文件"></p><p><img src="/2016/11/16/生成二维码/out.jpg" alt="输出"></p>]]></content>
    
    <summary type="html">
    
      生成带背景图片的二维码
    
    </summary>
    
    
    
      <category term="QR" scheme="http://tanqidong1992.github.io/tags/QR/"/>
    
      <category term="Java Code" scheme="http://tanqidong1992.github.io/tags/Java-Code/"/>
    
  </entry>
  
</feed>
